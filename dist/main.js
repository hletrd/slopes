"serviceWorker"in navigator&&window.addEventListener("load",(function(){"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?navigator.serviceWorker.getRegistrations().then((function(e){for(let t of e)t.unregister()})):navigator.serviceWorker.register("./service-worker.js").then((function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)})).catch((function(e){console.log("ServiceWorker registration failed: ",e)}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".toggle-menu"),t=document.querySelector(".sidebar"),n=document.querySelector(".sidebar-backdrop"),a=document.querySelector(".main-content"),o="Slopes cam";let i=[],s=null,c=null,r=[],l=[],d=window.innerWidth<=768,m=function(){try{const e=localStorage.getItem("webcamFavorites");return e?JSON.parse(e):[]}catch(e){return console.error("Error loading favorites:",e),[]}}(),u=function(){try{const e=localStorage.getItem("webcamSettings");if(e)return JSON.parse(e)}catch(e){console.error("Error loading settings:",e)}return{autoplay:!d}}();const p=document.getElementById("settingsButton"),f=document.getElementById("settingsModal"),h=document.getElementById("closeSettingsModal"),v=document.getElementById("autoplayToggle");v.checked=u.autoplay,v.addEventListener("change",(function(){u.autoplay=this.checked,function(){try{localStorage.setItem("webcamSettings",JSON.stringify(u))}catch(e){console.error("Error saving settings:",e)}}()})),p.addEventListener("click",(function(){f.style.display="block"})),h.addEventListener("click",(function(){f.style.display="none"})),window.addEventListener("click",(function(e){e.target===f&&(f.style.display="none")}));const g=document.getElementById("infoButton"),b=document.getElementById("infoModal"),y=document.getElementById("closeInfoModal");g.addEventListener("click",(function(){b.style.display="flex"})),y.addEventListener("click",(function(){b.style.display="none"})),window.addEventListener("click",(function(e){e.target===b&&(b.style.display="none")}));const w=document.getElementById("addToHomeButton"),E=document.getElementById("installationModal"),L=document.getElementById("closeModal");function C(){try{localStorage.setItem("webcamFavorites",JSON.stringify(m))}catch(e){console.error("Error saving favorites:",e)}}function N(e,t,n,a,o){const i=m.findIndex((n=>n.resortId===e&&n.webcamIndex===t));-1===i?m.push({resortId:e,webcamIndex:t,webcamName:n,resortName:r.find((t=>t.id===e))?.name||"",videoUrl:a,videoType:o}):m.splice(i,1),C(),k(),S()}function k(){document.querySelectorAll(".bookmark-button").forEach((e=>{!function(e,t){return m.some((n=>n.resortId===e&&n.webcamIndex===t))}(e.getAttribute("data-resort-id"),parseInt(e.getAttribute("data-webcam-index")))?(e.classList.remove("active"),e.querySelector(".bookmark-icon").innerHTML='<i class="bi bi-bookmark"></i>'):(e.classList.add("active"),e.querySelector(".bookmark-icon").innerHTML='<i class="bi bi-bookmark-fill"></i>')}))}function S(){const e=document.getElementById("favorites-container"),t=document.getElementById("favorites-grid");if(e&&t){if(0===m.length){const t=document.createElement("div");t.className="instruction",t.innerHTML="<p>북마크한 영상이 없습니다. 영상 오른쪽 위의 북마크 버튼을 눌러 영상을 추가해 보세요.<br>북마크는 같은 브라우저에서만 저장됩니다.</p>",e.appendChild(t)}if(e.style.display="block",t.innerHTML="",""===window.location.hash){const t=e.closest(".content-section");t&&(t.style.display="block")}else{const t=e.closest(".content-section");t&&(t.style.display="none")}i&&i.length>0&&(i=i.filter((e=>{const t=e.el_?.id;return!t||!t.includes("favorite-player")||(e.dispose(),!1)}))),m.forEach(((e,n)=>{const a=document.createElement("div");a.className="video-card favorite-card",a.draggable=!0,a.setAttribute("data-index",n);const o=document.createElement("div");o.className="drag-handle",o.innerHTML='<i class="bi bi-grip-vertical"></i>',a.appendChild(o);const s=document.createElement("div");s.className="favorites-header-container";const c=document.createElement("div");c.className="favorite-header";const r=document.createElement("span");r.className="favorite-location cursor-pointer",r.textContent=e.webcamName,r.addEventListener("click",(function(){const t=`${e.resortId}/${e.webcamIndex}`;window.location.hash=t}));const l=document.createElement("span");l.className="favorite-resort",l.textContent=e.resortName,c.appendChild(r),c.appendChild(l),s.appendChild(c);const d=document.createElement("button");d.className="favorites-remove-button",d.innerHTML='<i class="bi bi-trash"></i>',d.setAttribute("title","북마크 제거"),d.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),N(e.resortId,e.webcamIndex)})),s.appendChild(d),a.appendChild(s);const m=document.createElement("div");if(m.className="video-container",a.appendChild(m),t.appendChild(a),e.videoUrl){const t=`favorite-player-${n}`,a=K(e.videoUrl,m,t,e.videoType);a&&i.push(a)}a.addEventListener("dragstart",T),a.addEventListener("dragover",$),a.addEventListener("dragenter",q),a.addEventListener("dragleave",M),a.addEventListener("drop",A),a.addEventListener("dragend",H)})),_()}else console.error("Favorites container or grid not found")}w.addEventListener("click",(function(){E.style.display="block",setTimeout((function(){E.classList.add("active")}),10)})),L.addEventListener("click",(function(){E.classList.remove("active"),setTimeout((function(){E.style.display="none"}),400)})),E.addEventListener("click",(function(e){e.target===E&&L.click()}));let I=null,x=-1;function T(e){I=this,x=parseInt(this.getAttribute("data-index")),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.innerHTML),this.classList.add("dragging"),document.querySelectorAll(".favorite-card").forEach((e=>{e!==this&&e.classList.add("drop-target")}))}function $(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function q(e){this.classList.add("drag-over")}function M(e){this.classList.remove("drag-over")}function A(e){if(e.stopPropagation(),e.preventDefault(),this.classList.remove("drag-over"),I===this)return!1;const t=parseInt(this.getAttribute("data-index"));if(-1!==x&&-1!==t){const e=m[x];m.splice(x,1),m.splice(t,0,e),C(),S()}return!1}function H(e){document.querySelectorAll(".favorite-card").forEach((e=>{e.classList.remove("dragging","drag-over","drop-target")}))}function B(e,t,n=!1){const a=document.createElement("div");if(a.className="location-name",e.name.startsWith("리조트_")?a.textContent=e.name.replace("리조트_",""):a.textContent=e.name,t){const o=new Date(t);month=o.getMonth()+1,day=o.getDate(),hours=o.getHours().toString().padStart(2,"0"),minutes=o.getMinutes().toString().padStart(2,"0");const i=document.createElement("span");i.className="weather-update-time",i.textContent=`${month}월 ${day}일 ${hours}:${minutes} 기준`,n&&(e.name.startsWith("리조트_")?i.textContent+=" (리조트 제공)":i.textContent+=" (기상청 제공)"),a.appendChild(i)}return a}function D(e){const t=document.createElement("div");t.className="weather-data";class n{constructor(e,t,n,a,o=1){this.span=document.createElement("span"),this.span.className=e;const i=document.createElement("i");i.className=t,this.span.appendChild(i);const s=Number(n).toFixed(o);return this.span.appendChild(document.createTextNode(`${s}${a}`)),this.span}}if(null!==e.temperature){const a=new n("temperature","bi bi-thermometer-half",e.temperature,"°C");t.appendChild(a)}if(null!==e.humidity){t.appendChild(document.createTextNode(" • "));const a=new n("humidity","bi bi-moisture",e.humidity,"%",0);t.appendChild(a)}if(null!==e.wind_speed){t.appendChild(document.createTextNode(" • "));const a=new n("wind-speed","bi bi-wind",e.wind_speed,"m/s");t.appendChild(a)}if(null!==e.rainfall){t.appendChild(document.createTextNode(" • "));const a=new n("rainfall","bi bi-droplet-fill",e.rainfall,"mm");t.appendChild(a)}if(null!==e.snowfall_3hr){t.appendChild(document.createTextNode(" • "));const a=new n("snowfall","bi bi-snow",e.snowfall_3hr,"cm");t.appendChild(a)}return t}function _(){if(!l||0===l.length)return;if(!r||0===r.length)return;const e=document.getElementById("default-message");if(!e)return;const t=e.querySelector(".all-resorts-weather");t&&t.remove();const n=document.createElement("div");n.className="all-resorts-weather",n.innerHTML='<h3>전국 스키장 날씨 <span style="font-size: 0.6em; font-weight: normal; color: #999; margin-left: 6px;">기상청 데이터 기준</span></h3>';const a=document.createElement("div");if(a.className="weather-container",n.appendChild(a),r.forEach((e=>{const t=e.name,n=l.find((e=>e.resort===t&&"스키하우스"===e.name));if(n&&n.data&&n.data.length>0){const t=document.createElement("div");t.className="weather-info-wrapper";const o=document.createElement("div");o.className="weather-info";const i=n.data[n.data.length-1],s=B(e,n.timestamp,!1),c=D(i);o.appendChild(s),o.appendChild(c),t.appendChild(o),a.appendChild(t)}})),a.children.length>0){const t=e.querySelector("#favorites-container");t?t.after(n):e.appendChild(n)}const o=document.createElement("h3");o.style.marginTop="16px",o.textContent="전국 스키장 날씨";const i=document.createElement("span");i.textContent="리조트 데이터 기준",i.style.fontSize="0.6em",i.style.fontWeight="normal",i.style.color="#999",i.style.marginLeft="6px",o.appendChild(i),n.appendChild(o);const s=document.createElement("div");if(s.className="weather-container",n.appendChild(s),r.forEach((e=>{const t=e.name;l.filter((e=>e.resort===t&&e.name.startsWith("리조트_"))).forEach((t=>{if(t&&t.data&&t.data.length>0){const n=document.createElement("div");n.className="weather-info-wrapper";const a=document.createElement("div");a.className="weather-info";const o=t.data[t.data.length-1],i=B(e,t.timestamp,!1),c=D(o);a.appendChild(i),a.appendChild(c),n.appendChild(a),s.appendChild(n)}}))})),s.children.length>0){const t=e.querySelector("#favorites-container");t?t.after(n):e.appendChild(n)}}function R(){document.querySelectorAll(".submenu").forEach((e=>{e.classList.remove("active")})),document.querySelectorAll('.menu-item[data-has-submenu="true"]').forEach((e=>{e.classList.remove("active")})),document.querySelectorAll(".dropdown-toggle").forEach((e=>{e.innerHTML='<i class="bi bi-chevron-down"></i>'}))}function j(e,t){const n=t?`${e}/${t}`:e;if(window.location.hash.substring(1)===n)return;const a=new URL(window.location);a.hash=n,history.pushState(null,"",a),P(e,t)}function P(e,t){if(!e)return void(document.title=o);const n=r.find((t=>t.id===e));if(n)if(null!=t){const e=parseInt(t),a=n.links||n.webcams||[];if(!isNaN(e)&&a[e]){const t=a[e].name;document.title=`${o} - ${t} - ${n.name}`}else document.title=`${o} - ${n.name}`}else document.title=`${o} - ${n.name}`;else document.title=o}function W(){i&&i.length>0&&(i.forEach((e=>{e&&"function"==typeof e.dispose&&e.dispose()})),i=[])}function U(e){if(!l||0===l.length)return;const t=r.find((t=>t.id===e));if(!t)return;const n=t.name,a=l.filter((e=>e.resort===n));if(0===a.length)return;document.querySelectorAll(`.content-section[id^="${e}"]`).forEach((e=>{const t=e.querySelector(".weather-container");t&&t.remove();const n=document.createElement("div");n.className="weather-container",a.forEach((e=>{if(!e||!e.data||0===e.data.length)return;const t=e.data[e.data.length-1],a=document.createElement("div");a.className="weather-info-wrapper";const o=document.createElement("div");o.className="weather-info";const i=B(e,e.timestamp,!0),s=D(t);o.appendChild(i),o.appendChild(s),a.appendChild(o),n.appendChild(a)}));const o=e.querySelector(".videos-grid"),i=e.querySelector(".video-container");if(o)o.after(n);else if(i)i.after(n);else{const t=e.querySelector("h2");t?t.after(n):e.appendChild(n)}}))}function O(){const e=window.location.hash.substring(1);if(!e){document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const e=document.getElementById("default-message");return e.classList.add("active"),e.style.display="block",S(),void(document.title=o)}if(!window.processingHashChange){window.processingHashChange=!0;try{if("misc"===e){const e=document.getElementById("default-message");e.classList.remove("active"),e.style.display="none",document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active")));const t=document.querySelector('.menu-item[data-target="misc"]');t&&t.classList.add("active"),R(),W(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const n=document.getElementById("misc");return n&&n.classList.add("active"),void(document.title=`${o} - 유용한 기능`)}if(e.startsWith("misc/")){const t=document.getElementById("default-message");t.classList.remove("active"),t.style.display="none",document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active")));const n=document.querySelector('.menu-item[data-target="misc"]');n&&n.classList.add("active");const a=document.getElementById("misc-submenu");if(a){a.classList.add("active");const e=n.querySelector(".dropdown-toggle");e&&(e.innerHTML='<i class="bi bi-chevron-up"></i>')}if("forecast"===e.split("/")[1]){document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")}));const e=document.querySelector('.submenu-item[data-target="misc-forecast"]');e&&e.classList.add("active"),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const t=document.getElementById("misc-forecast");t&&t.classList.add("active"),document.title=`${o} - 일기예보`,_(),te(),ee()}return}const t=e.split("/"),n=t[0],a=t[1];P(n,a);const s=document.getElementById("default-message");s.classList.remove("active"),s.style.display="none";const c=document.querySelector(`.menu-item[data-target="${n}"]`);if(c){document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active"))),c.classList.add("active"),R(),c.classList.add("active"),W(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));if("true"===c.getAttribute("data-has-submenu")){const e=document.getElementById(`${n}-submenu`);if(e&&e.classList.add("active"),a){const e=parseInt(a);if(!isNaN(e)){const t=document.querySelector(`#${n}-submenu .submenu-item[data-webcam-index="${e}"]`);if(t){document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")})),t.classList.add("active");const a=document.getElementById(t.getAttribute("data-target"));if(a){a.classList.add("active");const t=a.querySelector(".video-container");if(t){const a=r.find((e=>e.id===n));if(a){const o=a.links||a.webcams||[];if(o[e]){const a=o[e].video||o[e].link;if(a){const s=K(a,t,`${n}-${e}`,o[e].video_type);s&&i.push(s),z(t,n,e,o[e].name,a,o[e].video_type),U(n)}else t.innerHTML='<div class="error-message">No video stream available</div>'}else t.innerHTML='<div class="error-message">No video stream available</div>'}}}}}}else{document.querySelectorAll(".submenu-item").forEach((e=>e.classList.remove("active")));const e=document.getElementById(`${n}-main`);e&&(e.classList.add("active"),F(n))}const t=c.querySelector(".dropdown-toggle");t&&(t.innerHTML='<i class="bi bi-chevron-up"></i>')}else{const e=document.getElementById(n);e&&e.classList.add("active")}l&&l.length>0?U(n):fetch("weather.json?v="+(new Date).getTime()).then((e=>e.ok?e.json():(console.warn("Weather data not available"),null))).then((e=>{e&&(l=e,console.log("Weather data loaded:",l.length,"locations"),U(n))})).catch((e=>{console.error("Error loading weather data:",e)}))}}finally{setTimeout((()=>{window.processingHashChange=!1,k()}),100)}}}function F(e){const t=r.find((t=>t.id===e));if(!t)return;const n=t.links||t.webcams||[];if(0===n.length)return;const a=document.getElementById(`${e}-main`);if(!a)return;let o=a.querySelector(".videos-grid");if(!o){o=document.createElement("div"),o.className="videos-grid";const e=a.querySelector("h2");e?e.after(o):a.appendChild(o)}o.innerHTML="",n.forEach(((t,n)=>{const a=t.video||t.link;if(!a)return;const s=document.createElement("div");s.className="video-card";const c=document.createElement("h3");c.textContent=t.name,c.className="cursor-pointer",c.addEventListener("click",(function(){const t=document.querySelector(`#${e}-submenu .submenu-item[data-webcam-index="${n}"]`);t&&t.click()})),s.appendChild(c);const r=document.createElement("div");r.className="video-container",s.appendChild(r),o.appendChild(s);const l=K(a,r,`${e}-grid-${n}`,t.video_type);l&&i.push(l),z(r,e,n,t.name,a,t.video_type)})),k(),U(e)}function K(e,t,n,a){t.innerHTML="";const o=n.split("-"),i=o[0];let s=parseInt(o[1]);3===o.length&&"grid"===o[1]&&(s=parseInt(o[2]));let c="";if(i&&!isNaN(s)){const e=r.find((e=>e.id===i));if(e){const t=e.links||e.webcams||[];t[s]&&(c=t[s].name||"")}}if("vivaldi"===a){const n=document.createElement("div");n.className="iframe-container";const o=e.split(":");if(2===o.length){const l=o[0],d=o[1];n.innerHTML=`<iframe src="vivaldi.html?channel=${l}&serial=${d}&autoplay=${u.autoplay}" allowfullscreen></iframe>`,t.appendChild(n),i&&!isNaN(s)&&z(t,i,s,c,e,a,V.VIVALDI);const m=document.createElement("button");return m.className="capture-button",m.innerHTML='\n          <i class="bi bi-camera"></i>\n          캡처\n          ',m.addEventListener("click",(()=>function(e){try{const t=e.querySelector("iframe");if(!t)return void alert("캡처할 영상을 찾을 수 없습니다.");const n=e.closest(".content-section");let a,o;if(n){const t=n.id.split("-");if(t.length>=3&&"webcam"===t[1]){const n=t[0],i=parseInt(t[2]),s=r.find((e=>e.id===n));if(s&&!isNaN(i)){(s.links||s.webcams||[])[i]&&(a=G(e),o=Y(e))}}}if(!a||!o){const t=window.location.hash.substring(1).split("/");if(t.length>1){const n=t[0],i=parseInt(t[1]),s=r.find((e=>e.id===n));if(s&&!isNaN(i)){(s.links||s.webcams||[])[i]&&(a=G(e),o=Y(e))}}}a||(a=G(e)),o||(o=Y(e));const i=`capture_${a}_${o}_${Q()}.jpg`,s=t.contentDocument.body;html2canvas(s,{useCORS:!1}).then((t=>{Z(t.toDataURL("image/jpeg"),i),J(e)}))}catch(e){console.error("Error capturing screenshot:",e),alert("캡처 중 오류가 발생했습니다.")}}(t))),t.appendChild(m),{dispose:function(){t.innerHTML=""}}}return t.innerHTML='<div class="error-message">Invalid vivaldi video URL format. Expected: "channel:serial"</div>',null}if("iframe"===a){const n=document.createElement("div");return n.className="iframe-container",n.innerHTML=`<iframe src="${e}" allowfullscreen></iframe>`,t.appendChild(n),i&&!isNaN(s)&&z(t,i,s,c,e,a,V.LINK),{dispose:function(){t.innerHTML=""}}}if("youtube"===a){const n=document.createElement("div");n.className="iframe-container";const o=function(e){const t=/^(?:https?:\/\/)?(?:www\.)?youtube\.com\/live\/([^#&?]*).*/,n=e.match(t);if(n&&n[1]&&11===n[1].length)return n[1];const a=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,o=e.match(a);return o&&11===o[2].length?o[2]:null}(e);if(o){const r=u.autoplay?"1":"0";return n.innerHTML=`<iframe src="https://www.youtube.com/embed/${o}?autoplay=${r}&mute=1" allowfullscreen></iframe>`,t.appendChild(n),i&&!isNaN(s)&&z(t,i,s,c,e,a,V.YOUTUBE),{dispose:function(){t.innerHTML=""}}}}if("link"===a){const n=document.createElement("div");n.className="d-flex justify-content-center align-items-center link-container";const o=document.createElement("a");return o.href=e,o.target="_blank",o.rel="noopener noreferrer",o.className="btn btn-primary btn-lg",o.innerHTML='\n        <i class="bi bi-box-arrow-up-right me-2"></i>\n        외부 링크\n      ',n.appendChild(o),t.appendChild(n),i&&!isNaN(s)&&z(t,i,s,c,e,a,V.LINK),{dispose:function(){t.innerHTML=""}}}const l=function(e){if(!e||!e.includes("-"))return null;const t=e.split("-");if(t.length<2)return null;const n=t[0];let a=parseInt(t[1]);3===t.length&&"grid"===t[1]&&(a=parseInt(t[2]));if(isNaN(a))return null;const o=r.find((e=>e.id===n));if(!o)return null;const i=o.links||o.webcams||[];return i[a]?{resort:o,webcam:i[a]}:null}(n);let d=null;l&&l.webcam&&l.webcam.link&&(d=l.webcam.link),t.innerHTML=`\n      <video\n        id="webcam-player-${n}"\n        class="video-js vjs-theme-forest vjs-big-play-centered"\n        controls\n        ${u.autoplay?"autoplay":""}\n        muted\n        playsinline\n        preload="auto"\n      >\n        <source src="${e}" type="application/x-mpegURL">\n        <p class="vjs-no-js">\n          최신 브라우저를 사용하세요.\n        </p>\n      </video>\n    `;try{const o=videojs(`webcam-player-${n}`,{liveui:!0,responsive:!0,fluid:!1,crossorigin:"anonymous",liveTracker:{trackingThreshold:0},controlBar:{captionsButton:!1,pictureInPictureToggle:!1},notSupportedMessage:"비디오 재생 중 오류가 발생했습니다."}),d=document.createElement("button");if(d.className="capture-button",d.innerHTML='\n        <i class="bi bi-camera"></i>\n        캡처\n      ',d.addEventListener("click",(()=>function(e){try{const t=document.createElement("canvas"),n=e.el().querySelector("video");t.width=n.videoWidth,t.height=n.videoHeight;t.getContext("2d").drawImage(n,0,0,t.width,t.height);const a=e.el().id;let o,i;if(a){const n=a.replace("webcam-player-","").split("-");if(n.length>=2){"grid"===n[1]?(o=n[0],i=parseInt(n[2])):(o=n[0],i=parseInt(n[1]));const a=r.find((e=>e.id===o));if(a&&!isNaN(i)){if((a.links||a.webcams||[])[i]){const n=G(e.el()),a=Y(e.el()),o=`capture_${n}_${a}_${Q()}.jpg`;Z(t.toDataURL("image/jpeg"),o);return void J(e.el().parentNode)}}}}const s=G(e.el()),c=Y(e.el()),l=`capture_${s}_${c}_${Q()}.jpg`;Z(t.toDataURL("image/jpeg"),l);J(e.el().parentNode)}catch(e){console.error("Error capturing frame:",e),alert("캡처 중 오류가 발생했습니다.")}}(o))),t.appendChild(d),document.pictureInPictureEnabled||document.exitPictureInPicture&&document.requestPictureInPicture){const e=document.createElement("button");e.className="pip-button",e.innerHTML='\n          <i class="bi bi-pip"></i>\n          PIP\n        ',e.addEventListener("click",(()=>function(e){const t=e.el().querySelector("video");if(!t)return;document.pictureInPictureElement?document.exitPictureInPicture().catch((e=>{console.error("Error exiting Picture-in-Picture mode:",e)})):(document.pictureInPictureEnabled||t.requestPictureInPicture)&&t.requestPictureInPicture().catch((e=>{console.error("Error entering Picture-in-Picture mode:",e)}))}(o))),t.appendChild(e)}return i&&!isNaN(s)&&z(t,i,s,c,e,a,V.DEFAULT),o.on("error",(function(){const n=o.error();console.error("Video player error:",n);let d=null;if(l&&l.webcam)d=l.webcam.link||null;else{const e=r.find((e=>e.id===i));if(e){const t=e.links||e.webcams||[];t[s]&&t[s].link&&(d=t[s].link)}}let m='<div class="error-message"><p>비디오 재생 중 오류가 발생했습니다.</p>';d&&(m+=`<div class="mt-3">\n            <a href="${d}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">\n              <i class="bi bi-box-arrow-up-right me-2"></i>\n              원본 링크에서 보기\n            </a>\n          </div>`),m+="</div>",t.innerHTML=m,i&&!isNaN(s)&&z(t,i,s,c,e,a,V.ERROR)})),o}catch(n){return console.error("Error creating video player:",n),t.innerHTML='<div class="error-message">비디오 플레이어를 생성하는 중 오류가 발생했습니다.</div>',i&&!isNaN(s)&&z(t,i,s,c,e,a,V.ERROR),null}}const V={ERROR:1,LINK:2,YOUTUBE:3,VIVALDI:4,DEFAULT:0};function z(e,t,n,a,o,i,s=V.DEFAULT){if("string"==typeof t&&t.includes("favorite-player"))return;if(e.querySelector(".bookmark-button"))return;const c=document.createElement("button");c.className="bookmark-button",c.setAttribute("data-resort-id",t),c.setAttribute("data-webcam-index",n),c.innerHTML='\n      <span class="bookmark-icon"><i class="bi bi-bookmark"></i></span>\n      북마크\n    ',c.addEventListener("click",(function(){N(t,n,a,o,i)})),s===V.ERROR?c.classList.add("bookmark-button-error"):s===V.LINK?c.classList.add("bookmark-button-link"):s===V.YOUTUBE?c.classList.add("bookmark-button-youtube"):s===V.VIVALDI&&c.classList.add("bookmark-button-vivaldi"),e.appendChild(c)}function J(e){const t=document.createElement("div");t.className="alert alert-success position-absolute top-0 start-50 translate-middle-x mt-3 success-message",t.textContent="캡처 완료!",e.appendChild(t),setTimeout((()=>{t.classList.add("fade-out"),setTimeout((()=>{t.remove()}),500)}),2e3)}function G(e){if(e){const t=e.closest(".favorite-card");if(t){const e=t.querySelector(".favorite-resort");if(e&&e.textContent)return X(e.textContent.trim())}}const t=document.querySelector(".content-section.active .resort-label");if(t&&t.textContent)return X(t.textContent.trim());const n=window.location.hash.substring(1);if(n){const e=n.split("/")[0],t=r.find((t=>t.id===e));if(t)return X(t.name)}const a=document.querySelector(".menu-item.active");if(a){return X(a.textContent.trim().split("\n")[0])}return"unknown"}function Y(e){const t=e.closest(".video-container"),n=t?.closest(".favorite-card");if(n){const e=n.querySelector(".favorite-location");if(e&&e.textContent)return X(e.textContent.trim())}const a=t.querySelector(".vjs-tech")||t.querySelector("iframe")||t.querySelector(".vivaldi-container");if(a&&a.id){const e=a.id.match(/player-([^-]+)-(\d+)/)||a.id.match(/player-([^-]+)-grid-(\d+)/);if(e&&e.length>=3){const t=e[1],n=parseInt(e[2]),a=r.find((e=>e.id===t));if(a){const e=a.links||a.webcams||[];if(e[n])return X(e[n].name)}}}const o=document.querySelector(".submenu-item.active");if(o&&!o.classList.contains("submenu-item-status"))return X(o.textContent.trim());const i=document.querySelector(".content-section.active .inline-title.inline-title-submenu");if(i&&i.textContent)return X(i.textContent.trim());const s=window.location.hash.substring(1);if(s){const e=s.split("/");if(e.length>1){const t=e[0],n=e[1];if(t&&n&&!isNaN(parseInt(n))){const e=r.find((e=>e.id===t));if(e){const t=e.links||e.webcams||[],a=parseInt(n);if(t[a])return X(t[a].name)}}}}const c=e.closest(".video-card");if(c){const e=c.querySelector("h3");if(e)return X(e.textContent.trim())}return"webcam"}function Q(){const e=new Date;return`${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}_${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`}function X(e){return e.replace(/[^가-힣\w\s,()-]/g,"").replace(/\s+/g,"_")}function Z(e,t){const n=document.createElement("a");n.href=e,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function ee(){window.innerWidth<=768&&(t.classList.remove("active"),n.classList.remove("active"))}function te(){fetch("weather.grid.json?v="+(new Date).getTime()).then((e=>{if(!e.ok)throw new Error("Failed to load forecast data");return e.json()})).then((e=>{!function(e){const t=document.getElementById("forecast");if(!t)return;t.innerHTML="";const n=document.createElement("div");n.className="forecast-header";const a=new Date(e.last_fetch_time);n.innerHTML=`<h4>5일 예보 <small>(${a.toLocaleDateString("ko-KR")} ${a.toLocaleTimeString("ko-KR")} 업데이트)</small></h4>`,t.appendChild(n);const o={temperature:"rgb(255, 99, 132)",wind:"rgb(54, 162, 235)",snowfall:"rgb(153, 102, 255)"},i=new Date,s=[];for(let e=0;e<=120;e+=3){const t=new Date(i.getTime()+60*e*60*1e3);s.push(t)}const c=r.filter((e=>e.name)),l=document.createElement("div");l.className="chart-grid",t.appendChild(l);const d=e.weathers;console.log("Weather data structure:",{lastFetchTime:e.last_fetch_time,weathersCount:d.length,sampleData:d[0]||null}),c.forEach((e=>{const t=e.name,n=d.find((e=>e&&"object"==typeof e&&e.resort===t));if(!n)return void console.error(`No forecast data found for resort ${t}`);const a=document.createElement("div");a.className="chart-container";const s=document.createElement("div");s.className="chart-header";const c=document.createElement("h4");if(c.textContent=t,s.appendChild(c),!n.forecasts){console.error(`Invalid data format for resort ${t}:`,n);const e=document.createElement("div");return e.className="alert alert-warning",e.textContent=`${t}의 예보 데이터를 불러올 수 없습니다.`,a.appendChild(e),void l.appendChild(a)}const r=n.forecasts.filter((e=>e&&"object"==typeof e));if(r.length>0&&console.log(`Sample forecast for ${t}:`,r[0]),0===r.length){console.error(`No valid forecasts for resort ${t}`);const e=document.createElement("div");return e.className="alert alert-warning",e.textContent=`${t}의 예보 데이터가 비어있습니다.`,a.appendChild(e),void l.appendChild(a)}const m=Math.max(...r.map((e=>e.temp||-1/0))),u=Math.min(...r.map((e=>e.temp||1/0))),p=r.reduce(((e,t)=>e+(t.snow_3h||0)),0),f=document.createElement("div");f.className="forecast-summary",f.innerHTML=`\n        <span class="temp-range">기온: ${u.toFixed(1)}°C ~ ${m.toFixed(1)}°C</span>\n        <span class="total-snow">총 강설량: ${p.toFixed(1)}cm</span>\n      `,s.appendChild(f),a.appendChild(s);const h=document.createElement("canvas");h.id=`chart-${e.id}`,a.appendChild(h),l.appendChild(a);const v=[],g=[],b=[],y=[];r.sort(((e,t)=>new Date(e.timestamp)-new Date(t.timestamp))),r.forEach((e=>{if(e&&e.timestamp){const t=new Date(e.timestamp);t>i&&t<new Date(i.getTime()+432e6)&&(y.push(t),v.push(e.temp),g.push(e.wind_speed),b.push(e.snow_3h||0))}})),Chart.defaults.color="#e0e0e0",Chart.defaults.borderColor="rgba(255, 255, 255, 0.1)",new Chart(h,{type:"line",data:{labels:y,datasets:[{label:"기온 (°C)",data:v,borderColor:o.temperature,backgroundColor:o.temperature+"33",borderWidth:2,yAxisID:"y",tension:.3,pointRadius:3,pointHoverRadius:5,fill:!1,spanGaps:!0},{label:"풍속 (m/s)",data:g,borderColor:o.wind,backgroundColor:o.wind+"33",borderWidth:2,yAxisID:"y1",tension:.3,pointRadius:3,pointHoverRadius:5,fill:!1,spanGaps:!0},{label:"강설량 (cm/3h)",data:b,borderColor:o.snowfall,backgroundColor:o.snowfall+"33",borderWidth:2,yAxisID:"y2",tension:.3,pointRadius:3,pointHoverRadius:5,fill:!1,spanGaps:!0}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{tooltip:{callbacks:{title:function(e){const t=new Date(e[0].parsed.x);return t.toLocaleDateString("ko-KR")+" "+t.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})}},backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1},legend:{position:"top",labels:{usePointStyle:!0,padding:15,color:"#e0e0e0",font:{weight:"bold"}}}},scales:{x:{type:"time",time:{unit:"day",displayFormats:{day:"M/d"},tooltipFormat:"yyyy년 MM월 dd일 HH:mm"},title:{display:!0,text:"날짜/시간",color:"#e0e0e0",font:{weight:"bold"}},ticks:{maxRotation:0,color:"#e0e0e0"},grid:{color:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)"}},y:{type:"linear",display:!0,position:"left",title:{display:!0,text:"기온 (°C)",color:o.temperature,font:{weight:"bold"}},suggestedMin:u-5,suggestedMax:m+5,ticks:{color:"#e0e0e0"},grid:{color:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)"}},y1:{type:"linear",display:!0,position:"right",title:{display:!0,text:"풍속 (m/s)",color:o.wind,font:{weight:"bold"}},grid:{drawOnChartArea:!1,color:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)"},ticks:{color:"#e0e0e0"}},y2:{type:"linear",display:!0,position:"right",title:{display:!0,text:"강설량 (cm/3h)",color:o.snowfall,font:{weight:"bold"}},grid:{drawOnChartArea:!1,color:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)"},suggestedMin:0,suggestedMax:1.5*Math.max(...b)||10,ticks:{color:"#e0e0e0"}}}}})})),0===l.children.length&&(t.innerHTML='<div class="alert alert-info">예보 데이터가 없습니다.</div>')}(e)})).catch((e=>{console.error("Error loading forecast data:",e);const t=document.getElementById("forecast");t&&(t.innerHTML='<div class="alert alert-danger">일기예보 데이터를 불러오지 못했습니다.</div>')}))}e.addEventListener("click",(function(){t.classList.toggle("active"),n.classList.toggle("active")})),n.addEventListener("click",ee),window.addEventListener("resize",(function(){d=window.innerWidth<=768,window.innerWidth>768&&(t.classList.remove("active"),n.classList.remove("active"))})),window.addEventListener("hashchange",O),function(){let e=Promise.resolve(null);window.location.hash&&(e=fetch("weather.json?v="+(new Date).getTime()).then((e=>e.ok?e.json():(console.warn("Weather data not available"),null))).then((e=>e?(l=e,e):null)).catch((e=>(console.error("Error loading weather data:",e),null)))),fetch("links.json?v="+(new Date).getTime()).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((n=>{if(Array.isArray(n)&&n.length>0)return function(e){r=e,t.innerHTML='<div class="site-title"><a href="./">Slopes cam</a></div>',document.getElementById("default-message"),Array.from(document.querySelectorAll(".content-section:not(#default-message)")).forEach((e=>e.remove()));const n=document.createElement("div");n.className="menu-item-container";const l=document.createElement("div");l.className="menu-item",l.setAttribute("data-target","misc"),l.setAttribute("data-has-submenu","true"),l.textContent="유용한 기능",n.appendChild(l);const d=document.createElement("span");d.className="dropdown-toggle",d.innerHTML='<i class="bi bi-chevron-down"></i>',d.setAttribute("aria-label","Toggle submenu"),l.appendChild(d),d.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();const t=n.querySelector(".submenu");if(t){const e=t.classList.contains("active");R(),e||(t.classList.add("active"),l.classList.add("active"),this.innerHTML='<i class="bi bi-chevron-up"></i>')}}));const m=document.createElement("div");m.className="submenu",m.id="misc-submenu",n.appendChild(m);const u=document.createElement("div");u.className="submenu-item",u.setAttribute("data-target","misc-forecast"),u.textContent="일기예보",m.appendChild(u);const p=document.createElement("div");p.className="content-section",p.id="misc-forecast";const f=document.createElement("h2");f.textContent="일기예보",f.className="inline-title",p.appendChild(f);const h=document.createElement("div");h.className="misc-content",h.innerHTML='\n      <div class="forecast-container">\n        <div id="forecast"></div>\n      </div>\n    ',p.appendChild(h),a.appendChild(p),u.addEventListener("click",(function(){document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")})),this.classList.add("active"),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const e=document.getElementById("default-message");e.classList.remove("active"),e.style.display="none",p.classList.add("active"),window.location.hash="misc/forecast",document.title=`${o} - 일기예보`,_(),te(),ee()}));const v=document.createElement("div");v.className="content-section",v.id="misc";const g=document.createElement("h2");g.textContent="유용한 기능",g.className="inline-title",v.appendChild(g);const b=document.createElement("div");b.className="misc-content",b.innerHTML="\n      <p>메뉴에서 기능을 선택하세요.</p>\n    ",v.appendChild(b),a.appendChild(v),l.addEventListener("click",(function(e){if(e.target.classList.contains("dropdown-toggle")||e.target.closest(".dropdown-toggle"))return;document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".submenu-item").forEach((e=>e.classList.remove("active"))),this.classList.add("active"),R(),W(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const t=document.getElementById("default-message");t.classList.remove("active"),t.style.display="none";const n=document.getElementById("misc-submenu");if(n){n.classList.add("active"),this.classList.add("active");const e=this.querySelector(".dropdown-toggle");e&&(e.innerHTML='<i class="bi bi-chevron-up"></i>')}const a=document.getElementById("misc");a&&a.classList.add("active"),window.location.hash="misc",document.title=`${o} - 유용한 기능`,ee()})),e.forEach((e=>{const n=e.id,o=e.name,r=e.links||e.webcams||[],l=r.length>0;if(0===r.length)return;const d=document.createElement("div");d.className="menu-item-container";const m=document.createElement("div");if(m.className="menu-item",m.setAttribute("data-target",n),l&&(m.setAttribute("data-has-submenu","true"),m.setAttribute("data-resort-id",n)),m.textContent=o,d.appendChild(m),l){const e=document.createElement("span");e.className="dropdown-toggle",e.innerHTML='<i class="bi bi-chevron-down"></i>',e.setAttribute("aria-label","Toggle submenu"),m.appendChild(e),e.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();const t=d.querySelector(".submenu");if(t){const e=t.classList.contains("active");R(),e||(t.classList.add("active"),m.classList.add("active"),this.innerHTML='<i class="bi bi-chevron-up"></i>')}}))}t.appendChild(d);const u=document.createElement("div");u.className="content-section",u.id=l?`${n}-main`:n;const p=document.createElement("h2");if(p.textContent=o,p.className="inline-title",u.appendChild(p),a.appendChild(u),l){const t=document.createElement("div");if(t.className="submenu",t.id=`${n}-submenu`,d.appendChild(t),e.status){const n=document.createElement("div");n.className="submenu-item submenu-item-status",n.innerHTML='오픈현황 <i class="bi bi-box-arrow-up-right me-1"></i>',t.appendChild(n),n.addEventListener("click",(function(){window.open(e.status,"_blank","noopener,noreferrer")}))}r.forEach(((e,s)=>{const l=e.name;if(!l)return;const d=document.createElement("div");d.className="submenu-item",d.setAttribute("data-target",`${n}-webcam-${s}`),d.setAttribute("data-webcam-index",s),d.textContent=l,t.appendChild(d);const m=document.createElement("div");m.className="content-section",m.id=`${n}-webcam-${s}`;const u=document.createElement("h2");u.textContent=l,u.className="inline-title inline-title-submenu cursor-pointer",u.addEventListener("click",(function(){const e=document.querySelector(`#${n}-submenu .submenu-item[data-webcam-index="${s}"]`);e&&e.click()})),m.appendChild(u);const p=document.createElement("span");p.textContent=o,p.className="resort-label",m.appendChild(p);const f=document.createElement("div");f.className="video-container",m.appendChild(f),a.appendChild(m),d.addEventListener("click",(function(){const e=this.getAttribute("data-webcam-index");c=e,j(n,e),P(n,e),document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")})),this.classList.add("active"),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const t=document.getElementById("default-message");t.classList.remove("active"),t.style.display="none";const a=document.getElementById(this.getAttribute("data-target"));if(a){a.classList.add("active"),W();const t=a.querySelector(".video-container");if(t&&r[e]){const a=r[e].video||r[e].link;if(a){const o=K(a,t,`${n}-${e}`,r[e].video_type);o&&i.push(o),U(n)}else t.innerHTML='<div class="error-message">No video stream available</div>'}}ee()}))}))}m.addEventListener("click",(function(e){if(e.target.classList.contains("dropdown-toggle")||e.target.closest(".dropdown-toggle"))return;const t=this.getAttribute("data-target"),n="true"===this.getAttribute("data-has-submenu"),a=this.getAttribute("data-resort-id");if(a&&(s=a,c=null),j(t),P(t,null),document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".submenu-item").forEach((e=>e.classList.remove("active"))),this.classList.add("active"),R(),n){const e=document.getElementById(`${t}-submenu`);if(e){e.classList.add("active"),this.classList.add("active");const t=this.querySelector(".dropdown-toggle");t&&(t.innerHTML='<i class="bi bi-chevron-up"></i>')}}W(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const o=document.getElementById("default-message");if(o.classList.remove("active"),o.style.display="none",n){const e=document.getElementById(`${t}-main`);e&&(e.classList.add("active"),F(t))}else{const e=document.getElementById(t);e&&e.classList.add("active")}U(t),ee()}))})),!window.location.hash&&r.length>0||window.location.hash&&O()}(n),e.then((e=>e||fetch("weather.json?v="+(new Date).getTime()).then((e=>e.ok?e.json():(console.warn("Weather data not available"),null)))));throw new Error("Invalid data format")})).then((e=>{if(e){if(l=e,console.log("Weather data loaded:",l.length,"locations"),window.location.hash){const e=window.location.hash.substring(1).split("/")[0];e&&U(e)}_()}window.location.hash?O():S()})).catch((e=>{console.error("Error initializing app:",e);const t=document.getElementById("default-message");t?(t.innerHTML='<div class="error-message p-5 text-center"><h3>리조트 정보를 불러오지 못했습니다.</h3><p>페이지를 새로고침하세요.</p></div>',t.classList.add("active")):a.innerHTML='<div class="error-message">리조트 정보를 불러오지 못했습니다.</div>'}))}()}));