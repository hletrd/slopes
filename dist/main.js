"serviceWorker"in navigator&&window.addEventListener("load",(function(){"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?navigator.serviceWorker.getRegistrations().then((function(e){for(let t of e)t.unregister()})):navigator.serviceWorker.register("./service-worker.js").then((function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)})).catch((function(e){console.log("ServiceWorker registration failed: ",e)}))})),document.addEventListener("DOMContentLoaded",(async function(){await i18n.init();const e=(e,t)=>i18n.t(e,t),t=e=>i18n.getResortName(e.id,e.name),n=(e,t,n)=>i18n.getWebcamName(e.id,t,n),o=e=>i18n.getWeatherLocationName(e),a=document.querySelector(".toggle-menu"),i=document.querySelector(".sidebar"),s=document.querySelector(".sidebar-backdrop"),r=document.querySelector(".main-content"),c=e("site.title");let l=[],d=[],u=[null,null,null,null],m=null,p=null,f=[],h=[],v=window.innerWidth<=768,g=function(){try{const e=localStorage.getItem("webcamFavorites");return e?JSON.parse(e):[]}catch(e){return console.error("Error loading favorites:",e),[]}}(),y=function(){try{const e=localStorage.getItem("webcamSettings");if(e){const t=JSON.parse(e);return void 0===t.autoplay&&(t.autoplay=!v),void 0===t.darkMode&&(t.darkMode=!0),t}}catch(e){console.error("Error loading settings:",e)}return{autoplay:!v,darkMode:!0,quadViewOpen:!1}}(),b=function(){try{const e=localStorage.getItem("quadViewSelections");if(e){const t=JSON.parse(e);if(Array.isArray(t)){for(;t.length<4;)t.push("");return t.slice(0,4).map((e=>"string"==typeof e?e:""))}}}catch(e){console.error("Error loading quad selections:",e)}return["","","",""]}();function w(){try{localStorage.setItem("webcamSettings",JSON.stringify(y))}catch(e){console.error("Error saving settings:",e)}}function E(){try{localStorage.setItem("quadViewSelections",JSON.stringify(b))}catch(e){console.error("Error saving quad selections:",e)}}function L(){!1===y.darkMode?(document.body.classList.add("light-mode"),document.documentElement.setAttribute("data-theme","light")):(document.body.classList.remove("light-mode"),document.documentElement.setAttribute("data-theme","dark")),j()}const C=document.getElementById("settingsButton"),k=document.getElementById("settingsModal"),S=document.getElementById("closeSettingsModal"),N=document.getElementById("autoplayToggle"),I=document.getElementById("themeToggle");L(),N.checked=y.autoplay,I&&(I.checked=!1!==y.darkMode),N.addEventListener("change",(function(){y.autoplay=this.checked,w()})),I&&I.addEventListener("change",(function(){y.darkMode=this.checked,L(),w()}));const q=document.getElementById("languageSelect");q&&(q.value=i18n.getLanguage(),q.addEventListener("change",(async function(){await i18n.setLanguage(this.value),document.documentElement.lang=this.value,window.location.reload()}))),C.addEventListener("click",(function(){k.style.display="block"})),S.addEventListener("click",(function(){k.style.display="none"})),window.addEventListener("click",(function(e){e.target===k&&(k.style.display="none")}));const $=document.getElementById("infoButton"),x=document.getElementById("infoModal"),T=document.getElementById("closeInfoModal");$.addEventListener("click",(function(){x.style.display="flex"})),T.addEventListener("click",(function(){x.style.display="none"})),window.addEventListener("click",(function(e){e.target===x&&(x.style.display="none")}));const A=document.getElementById("addToHomeButton"),M=document.getElementById("installationModal"),B=document.getElementById("closeModal"),H=document.getElementById("quadViewButton"),R=document.getElementById("quadViewContainer"),D=document.getElementById("quadBackButton"),_=Array.from(document.querySelectorAll(".quad-select")),P=Array.from(document.querySelectorAll(".quad-video"));function W(e,t,n=!1){const o=P[e];if(!o)return;if(u[e]&&"function"==typeof u[e].dispose&&u[e].dispose(),u[e]=null,o.innerHTML="",!t)return b[e]="",void(n||E());const[a,i]=t.split("||"),s=parseInt(i,10),r=f.find((e=>e.id===a));if(!r||isNaN(s))return;const c=(r.links||r.webcams||[])[s];if(!c)return;const l=c.video||c.link;if(!l)return;const d=fe(l,o,`quad-${a}-${s}`,c.video_type,!0);d&&(u[e]=d),b[e]=t,n||E()}function j(){const e=document.getElementById("quadViewPage");e&&(!1===y.darkMode?e.classList.add("light-mode"):e.classList.remove("light-mode"))}function F(){if(!Array.isArray(f)||0===f.length)return;if(window.quadSelectsInitialized)return;window.quadSelectsInitialized=!0;const o=document.querySelectorAll(".custom-dropdown");document.addEventListener("click",(function(e){e.target.closest(".custom-dropdown")||document.querySelectorAll(".custom-dropdown").forEach((e=>e.classList.remove("active")))})),o.forEach(((o,a)=>{const i=o.querySelector(".dropdown-trigger"),s=(o.querySelector(".dropdown-menu"),o.querySelector(".dropdown-search")),r=o.querySelector(".dropdown-list"),c=parseInt(o.getAttribute("data-slot"));function l(e){r.querySelectorAll(".dropdown-item");r.querySelectorAll(".dropdown-group").forEach((t=>{let n=!1;const o=t.querySelectorAll(".dropdown-item");o.forEach((t=>{t.textContent.toLowerCase().includes(e)?(t.style.display="flex",n=!0):t.style.display="none"}));const a=t.querySelector(".dropdown-group-header");a&&(a.textContent.toLowerCase().includes(e)&&o.forEach((e=>{e.style.display="flex",n=!0})),a.style.display=n?"block":"none")}))}i.addEventListener("click",(function(){const e=o.classList.contains("active");document.querySelectorAll(".custom-dropdown").forEach((e=>e.classList.remove("active"))),e||(o.classList.add("active"),s.value="",l(""),s.focus())})),s.addEventListener("input",(function(e){l(e.target.value.toLowerCase())})),r.innerHTML="";const d=document.createElement("div");d.className="dropdown-group";const u=document.createElement("div");function m(e,t){i.textContent=t,o.classList.remove("active"),r.querySelectorAll(".dropdown-item").forEach((e=>e.classList.remove("selected")));const n=r.querySelector(`.dropdown-item[data-value="${e}"]`);n&&n.classList.add("selected"),W(c,e)}u.className="dropdown-item",u.textContent=e("camera.none"),u.dataset.value="",u.addEventListener("click",(()=>m("",e("camera.select")))),d.appendChild(u),r.appendChild(d),f.forEach((o=>{const a=o.links||o.webcams||[];if(0===a.length)return;const i=document.createElement("div");i.className="dropdown-group";const s=document.createElement("div");s.className="dropdown-group-header",s.textContent=t(o),i.appendChild(s),a.forEach(((a,s)=>{if(!(a.video||a.link))return;const r=document.createElement("div");r.className="dropdown-item";const c=n(o,s,a.name)||e("camera.default")+` ${s+1}`;r.innerHTML=`<i class="bi bi-camera-video"></i> ${c}`,r.dataset.value=`${o.id}||${s}`,r.addEventListener("click",(()=>{const e=`${t(o)} - ${c}`;m(r.dataset.value,e)})),i.appendChild(r)})),r.appendChild(i)}));const p=b[a]||"";if(p){const[o,s]=p.split("||"),c=f.find((e=>e.id===o));if(c){const o=(c.links||c.webcams||[])[parseInt(s)];if(o){const l=n(c,parseInt(s),o.name)||e("camera.default")+` ${parseInt(s)+1}`,d=`${t(c)} - ${l}`;i.textContent=d,setTimeout((()=>{const e=r.querySelector(`.dropdown-item[data-value="${p}"]`);e&&e.classList.add("selected")}),0),W(a,p,!0)}}}else W(a,"",!0)}))}function O(e=!1){R&&(R.classList.add("active"),document.body.classList.add("quad-view-open"),de(),F(),j(),e&&(window.location.hash="quad"),y.quadViewOpen=!0,w())}function U(e=!1){R&&(R.classList.remove("active"),document.body.classList.remove("quad-view-open"),u.forEach(((e,t)=>{if(e&&"function"==typeof e.dispose)try{e.dispose()}catch(e){console.error("Error disposing quad player",e)}u[t]=null})),P.forEach((e=>{e.innerHTML=""})),e&&"#quad"===window.location.hash&&(window.location.hash=""),y.quadViewOpen=!1,w())}A.addEventListener("click",(function(){M.style.display="block",setTimeout((function(){M.classList.add("active")}),10)})),B.addEventListener("click",(function(){M.classList.remove("active"),setTimeout((function(){M.style.display="none"}),400)})),M.addEventListener("click",(function(e){e.target===M&&B.click()})),function(){const e=[document.getElementById("addToHomeButton"),document.getElementById("settingsButton"),document.getElementById("quadViewButton")],t=document.querySelector(".floating-button-group");t&&e.forEach((e=>{e&&t.appendChild(e)}))}(),y.quadViewOpen&&O(!0),H&&H.addEventListener("click",(function(){O(!0)})),D&&D.addEventListener("click",(function(){U(!0)}));const V=document.getElementById("quadAddToHomeButton");function z(){try{localStorage.setItem("webcamFavorites",JSON.stringify(g))}catch(e){console.error("Error saving favorites:",e)}}function K(e,t,n,o,a){const i=g.findIndex((n=>n.resortId===e&&n.webcamIndex===t));-1===i?g.push({resortId:e,webcamIndex:t,webcamName:n,resortName:f.find((t=>t.id===e))?.name||"",videoUrl:o,videoType:a}):g.splice(i,1),z(),J(),G()}function J(){document.querySelectorAll(".bookmark-button").forEach((e=>{!function(e,t){return g.some((n=>n.resortId===e&&n.webcamIndex===t))}(e.getAttribute("data-resort-id"),parseInt(e.getAttribute("data-webcam-index")))?(e.classList.remove("active"),e.querySelector(".bookmark-icon").innerHTML='<i class="bi bi-bookmark"></i>'):(e.classList.add("active"),e.querySelector(".bookmark-icon").innerHTML='<i class="bi bi-bookmark-fill"></i>')}))}function G(){const t=document.getElementById("favorites-container"),n=document.getElementById("favorites-grid");if(t&&n){if(0===g.length){const n=document.createElement("div");n.className="instruction",n.innerHTML=`<p>${e("bookmarks.empty")}<br>${e("bookmarks.browserOnly")}</p>`,t.appendChild(n)}if(t.style.display="block",n.innerHTML="",""===window.location.hash){const e=t.closest(".content-section");e&&(e.style.display="block")}else{const e=t.closest(".content-section");e&&(e.style.display="none")}l&&l.length>0&&(l=l.filter((e=>{const t=e.el_?.id;return!t||!t.includes("favorite-player")||(e.dispose(),!1)}))),g.forEach(((t,o)=>{const a=document.createElement("div");a.className="video-card favorite-card",a.draggable=!0,a.setAttribute("data-index",o);const i=document.createElement("div");i.className="drag-handle",i.innerHTML='<i class="bi bi-grip-vertical"></i>',a.appendChild(i);const s=document.createElement("div");s.className="favorites-header-container";const r=document.createElement("div");r.className="favorite-header";const c=document.createElement("span");c.className="favorite-location cursor-pointer",c.textContent=t.webcamName,c.addEventListener("click",(function(){const e=`${t.resortId}/${t.webcamIndex}`;window.location.hash=e}));const d=document.createElement("span");d.className="favorite-resort",d.textContent=t.resortName,r.appendChild(c),r.appendChild(d),s.appendChild(r);const u=document.createElement("button");u.className="favorites-remove-button",u.innerHTML='<i class="bi bi-trash"></i>',u.setAttribute("title",e("buttons.removeBookmark")),u.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),K(t.resortId,t.webcamIndex)})),s.appendChild(u),a.appendChild(s);const m=document.createElement("div");if(m.className="video-container",a.appendChild(m),n.appendChild(a),t.videoUrl){const e=`favorite-player-${o}`,n=fe(t.videoUrl,m,e,t.videoType);n&&l.push(n)}a.addEventListener("dragstart",X),a.addEventListener("dragover",Z),a.addEventListener("dragenter",ee),a.addEventListener("dragleave",te),a.addEventListener("drop",ne),a.addEventListener("dragend",oe)})),se()}else console.error("Favorites container or grid not found")}V&&V.addEventListener("click",(function(){const e=document.getElementById("installationModal");e&&(e.style.display="block",setTimeout((function(){e.classList.add("active")}),10))})),_.forEach(((e,t)=>{e.addEventListener("change",(function(){W(t,this.value)}))}));let Y=null,Q=-1;function X(e){Y=this,Q=parseInt(this.getAttribute("data-index")),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.innerHTML),this.classList.add("dragging"),document.querySelectorAll(".favorite-card").forEach((e=>{e!==this&&e.classList.add("drop-target")}))}function Z(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function ee(e){this.classList.add("drag-over")}function te(e){this.classList.remove("drag-over")}function ne(e){if(e.stopPropagation(),e.preventDefault(),this.classList.remove("drag-over"),Y===this)return!1;const t=parseInt(this.getAttribute("data-index"));if(-1!==Q&&-1!==t){const e=g[Q];g.splice(Q,1),g.splice(t,0,e),z(),G()}return!1}function oe(e){document.querySelectorAll(".favorite-card").forEach((e=>{e.classList.remove("dragging","drag-over","drop-target")}))}function ae(n,a,i=!1){const s=document.createElement("div");if(s.className="location-name",n.name.startsWith("리조트_")){const e=n.name.replace("리조트_","");s.textContent=o(e)}else n.id?s.textContent=t(n):s.textContent=o(n.name);if(a){const t=new Date(a);month=t.getMonth()+1,day=t.getDate(),hours=t.getHours().toString().padStart(2,"0"),minutes=t.getMinutes().toString().padStart(2,"0");const o=document.createElement("span");o.className="weather-update-time",o.textContent=e("weather.updateTime",{month:month,day:day,hours:hours,minutes:minutes}),i&&(n.name.startsWith("리조트_")?o.textContent+=` (${e("weather.resortProvided")})`:o.textContent+=` (${e("weather.kmaProvided")})`),s.appendChild(o)}return s}function ie(e){const t=document.createElement("div");t.className="weather-data";class n{constructor(e,t,n,o,a=1){this.span=document.createElement("span"),this.span.className=e;const i=document.createElement("i");i.className=t,this.span.appendChild(i);const s=Number(n).toFixed(a);return this.span.appendChild(document.createTextNode(`${s}${o}`)),this.span}}if(null!==e.temperature){const o=new n("temperature","bi bi-thermometer-half",e.temperature,"°C");t.appendChild(o)}if(null!==e.humidity){t.appendChild(document.createTextNode(" • "));const o=new n("humidity","bi bi-moisture",e.humidity,"%",0);t.appendChild(o)}if(null!==e.wind_speed){t.appendChild(document.createTextNode(" • "));const o=new n("wind-speed","bi bi-wind",e.wind_speed,"m/s");t.appendChild(o)}if(null!==e.rainfall){t.appendChild(document.createTextNode(" • "));const o=new n("rainfall","bi bi-droplet-fill",e.rainfall,"mm");t.appendChild(o)}if(null!==e.snowfall_3hr){t.appendChild(document.createTextNode(" • "));const o=new n("snowfall","bi bi-snow",e.snowfall_3hr,"cm");t.appendChild(o)}return t}function se(){if(!h||0===h.length)return;if(!f||0===f.length)return;const t=document.getElementById("default-message");if(!t)return;const n=t.querySelector(".all-resorts-weather");n&&n.remove();const o=document.createElement("div");o.className="all-resorts-weather",o.innerHTML=`<h3>${e("weather.allResortsTitle")} <span style="font-size: 0.6em; font-weight: normal; color: #999; margin-left: 6px;">${e("weather.kmaData")}</span></h3>`;const a=document.createElement("div");if(a.className="weather-container",o.appendChild(a),f.forEach((e=>{const t=e.name,n=h.find((e=>e.resort===t&&"스키하우스"===e.name));if(n&&n.data&&n.data.length>0){const t=document.createElement("div");t.className="weather-info-wrapper";const o=document.createElement("div");o.className="weather-info";const i=n.data[n.data.length-1],s=ae(e,n.timestamp,!1),r=ie(i);o.appendChild(s),o.appendChild(r),t.appendChild(o),a.appendChild(t)}})),a.children.length>0){const e=t.querySelector("#favorites-container");e?e.after(o):t.appendChild(o)}const i=document.createElement("h3");i.style.marginTop="16px",i.textContent=e("weather.allResortsTitle");const s=document.createElement("span");s.textContent=e("weather.resortData"),s.style.fontSize="0.6em",s.style.fontWeight="normal",s.style.color="#999",s.style.marginLeft="6px",i.appendChild(s),o.appendChild(i);const r=document.createElement("div");if(r.className="weather-container",o.appendChild(r),f.forEach((e=>{const t=e.name;h.filter((e=>e.resort===t&&e.name.startsWith("리조트_"))).forEach((t=>{if(t&&t.data&&t.data.length>0){const n=document.createElement("div");n.className="weather-info-wrapper";const o=document.createElement("div");o.className="weather-info";const a=t.data[t.data.length-1],i=ae(e,t.timestamp,!1),s=ie(a);o.appendChild(i),o.appendChild(s),n.appendChild(o),r.appendChild(n)}}))})),r.children.length>0){const e=t.querySelector("#favorites-container");e?e.after(o):t.appendChild(o)}}function re(){document.querySelectorAll(".submenu").forEach((e=>{e.classList.remove("active")})),document.querySelectorAll('.menu-item[data-has-submenu="true"]').forEach((e=>{e.classList.remove("active")})),document.querySelectorAll(".dropdown-toggle").forEach((e=>{e.innerHTML='<i class="bi bi-chevron-down"></i>'}))}function ce(e,t){const n=t?`${e}/${t}`:e;if(window.location.hash.substring(1)===n)return;const o=new URL(window.location);o.hash=n,history.pushState(null,"",o),le(e,t)}function le(e,o){if(!e)return void(document.title=c);const a=f.find((t=>t.id===e));if(a)if(null!=o){const e=parseInt(o),i=a.links||a.webcams||[];if(!isNaN(e)&&i[e]){const o=n(a,e,i[e].name);document.title=`${c} - ${o} - ${t(a)}`}else document.title=`${c} - ${t(a)}`}else document.title=`${c} - ${t(a)}`;else document.title=c}function de(){l&&l.length>0&&(l.forEach((e=>{e&&"function"==typeof e.dispose&&e.dispose()})),l=[])}function ue(e){if(!h||0===h.length)return;const t=f.find((t=>t.id===e));if(!t)return;const n=t.name,o=h.filter((e=>e.resort===n));if(0===o.length)return;document.querySelectorAll(`.content-section[id^="${e}"]`).forEach((e=>{const t=e.querySelector(".weather-container");t&&t.remove();const n=document.createElement("div");n.className="weather-container",o.forEach((e=>{if(!e||!e.data||0===e.data.length)return;const t=e.data[e.data.length-1],o=document.createElement("div");o.className="weather-info-wrapper";const a=document.createElement("div");a.className="weather-info";const i=ae(e,e.timestamp,!0),s=ie(t);a.appendChild(i),a.appendChild(s),o.appendChild(a),n.appendChild(o)}));const a=e.querySelector(".videos-grid"),i=e.querySelector(".video-container");if(a)a.after(n);else if(i)i.after(n);else{const t=e.querySelector("h2");t?t.after(n):e.appendChild(n)}}))}function me(){const t=window.location.hash.substring(1);if(!t){U(!1),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const e=document.getElementById("default-message");return e.classList.add("active"),e.style.display="block",G(),void(document.title=c)}if(!window.processingHashChange){window.processingHashChange=!0;try{if("quad"===t)return O(!1),void(document.title=`${c} - 4분할 모드`);if(U(!1),"misc"===t){const t=document.getElementById("default-message");t.classList.remove("active"),t.style.display="none",document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active")));const n=document.querySelector('.menu-item[data-target="misc"]');n&&n.classList.add("active"),re(),de(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const o=document.getElementById("misc");return o&&o.classList.add("active"),void(document.title=`${c} - ${e("nav.usefulFeatures")}`)}if(t.startsWith("misc/")){const n=document.getElementById("default-message");n.classList.remove("active"),n.style.display="none",document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active")));const o=document.querySelector('.menu-item[data-target="misc"]');o&&o.classList.add("active");const a=document.getElementById("misc-submenu");if(a){a.classList.add("active");const e=o.querySelector(".dropdown-toggle");e&&(e.innerHTML='<i class="bi bi-chevron-up"></i>')}if("forecast"===t.split("/")[1]){document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")}));const t=document.querySelector('.submenu-item[data-target="misc-forecast"]');t&&t.classList.add("active"),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const n=document.getElementById("misc-forecast");n&&n.classList.add("active"),document.title=`${c} - ${e("nav.forecast")}`,se(),Se(),ke()}return}const o=t.split("/"),a=o[0],i=o[1];le(a,i);const s=document.getElementById("default-message");s.classList.remove("active"),s.style.display="none";const r=document.querySelector(`.menu-item[data-target="${a}"]`);if(r){document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active"))),r.classList.add("active"),re(),r.classList.add("active"),de(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));if("true"===r.getAttribute("data-has-submenu")){const e=document.getElementById(`${a}-submenu`);if(e&&e.classList.add("active"),i){const e=parseInt(i);if(!isNaN(e)){const t=document.querySelector(`#${a}-submenu .submenu-item[data-webcam-index="${e}"]`);if(t){document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")})),t.classList.add("active");const o=document.getElementById(t.getAttribute("data-target"));if(o){o.classList.add("active");const t=o.querySelector(".video-container");if(t){const o=f.find((e=>e.id===a));if(o){const i=o.links||o.webcams||[];if(i[e]){const s=i[e].video||i[e].link;if(s){const r=fe(s,t,`${a}-${e}`,i[e].video_type);r&&l.push(r),ve(t,a,e,n(o,e,i[e].name),s,i[e].video_type),ue(a)}else t.innerHTML='<div class="error-message">No video stream available</div>'}else t.innerHTML='<div class="error-message">No video stream available</div>'}}}}}}else{document.querySelectorAll(".submenu-item").forEach((e=>e.classList.remove("active")));const e=document.getElementById(`${a}-main`);e&&(e.classList.add("active"),pe(a))}const t=r.querySelector(".dropdown-toggle");t&&(t.innerHTML='<i class="bi bi-chevron-up"></i>')}else{const e=document.getElementById(a);e&&e.classList.add("active")}h&&h.length>0?ue(a):fetch("weather.json?v="+(new Date).getTime()).then((e=>e.ok?e.json():(console.warn("Weather data not available"),null))).then((e=>{e&&(h=e,console.log("Weather data loaded:",h.length,"locations"),ue(a))})).catch((e=>{console.error("Error loading weather data:",e)}))}}finally{setTimeout((()=>{window.processingHashChange=!1,J(),qe()}),100)}}}function pe(e){const t=f.find((t=>t.id===e));if(!t)return;const o=t.links||t.webcams||[];if(0===o.length)return;const a=document.getElementById(`${e}-main`);if(!a)return;let i=a.querySelector(".videos-grid");if(!i){i=document.createElement("div"),i.className="videos-grid";const e=a.querySelector("h2");e?e.after(i):a.appendChild(i)}i.innerHTML="",o.forEach(((o,a)=>{const s=o.video||o.link;if(!s)return;const r=document.createElement("div");r.className="video-card";const c=document.createElement("h3");c.textContent=n(t,a,o.name),c.className="cursor-pointer",c.addEventListener("click",(function(){const t=document.querySelector(`#${e}-submenu .submenu-item[data-webcam-index="${a}"]`);t&&t.click()})),r.appendChild(c);const d=document.createElement("div");d.className="video-container",r.appendChild(d),i.appendChild(r);const u=fe(s,d,`${e}-grid-${a}`,o.video_type);u&&l.push(u),ve(d,e,a,n(t,a,o.name),s,o.video_type)})),J(),ue(e),setTimeout(qe,500)}function fe(o,a,i,s,r=null){a.innerHTML="";const c=i.split("-"),l=c[0];let u=parseInt(c[1]);3===c.length&&"grid"===c[1]&&(u=parseInt(c[2]));let m="";if(l&&!isNaN(u)){const e=f.find((e=>e.id===l));if(e){const t=e.links||e.webcams||[];t[u]&&(m=n(e,u,t[u].name)||"")}}if("vivaldi"===s){const t=document.createElement("div");t.className="iframe-container";const n=o.split(":");if(2===n.length){const i=n[0],c=n[1],p=null!==r?r:y.autoplay;t.innerHTML=`<iframe src="vivaldi.html?channel=${i}&serial=${c}&autoplay=${p}" allowfullscreen></iframe>`,a.appendChild(t);const h={iframe:t.querySelector("iframe"),container:t,channel:i,serial:c,_paused:!p,el:function(){return this.container},paused:function(){return this._paused},play:function(){this._paused&&this.iframe&&this.iframe.contentWindow&&(this.iframe.contentWindow.postMessage({action:"play"},"*"),this._paused=!1)},pause:function(){!this._paused&&this.iframe&&this.iframe.contentWindow&&(this.iframe.contentWindow.postMessage({action:"pause"},"*"),this._paused=!0)}};d.push(h),l&&!isNaN(u)&&ve(a,l,u,m,o,s,he.VIVALDI);const v=document.createElement("button");return v.className="capture-button",v.innerHTML=`\n          <i class="bi bi-camera"></i>\n          ${e("buttons.capture")}\n          `,v.addEventListener("click",(()=>{const t=a.querySelector("iframe");if(t)try{const n=t.contentDocument.getElementById("player-container");if(n&&!n.classList.contains("playing"))return void ge(a,e("messages.captureOnlyWhilePlaying"),"warning")}catch(e){console.error("Cannot check vivaldi playing state",e)}!function(t){try{const n=t.querySelector("iframe");if(!n)return void alert(e("errors.captureNotFound"));const o=t.closest(".content-section");let a,i;if(o){const e=o.id.split("-");if(e.length>=3&&"webcam"===e[1]){const n=e[0],o=parseInt(e[2]),s=f.find((e=>e.id===n));if(s&&!isNaN(o)){(s.links||s.webcams||[])[o]&&(a=ye(t),i=be(t))}}}if(!a||!i){const e=window.location.hash.substring(1).split("/");if(e.length>1){const n=e[0],o=parseInt(e[1]),s=f.find((e=>e.id===n));if(s&&!isNaN(o)){(s.links||s.webcams||[])[o]&&(a=ye(t),i=be(t))}}}a||(a=ye(t)),i||(i=be(t));const s=`capture_${a}_${i}_${we()}.jpg`,r=n.contentDocument.body;html2canvas(r,{useCORS:!1}).then((n=>{Le(n.toDataURL("image/jpeg"),s),ge(t,e("messages.captureSuccess"),"success")}))}catch(n){console.error("Error capturing screenshot:",n),ge(t,e("errors.captureError"),"danger")}}(a)})),a.appendChild(v),{dispose:function(){const e=d.indexOf(h);e>-1&&d.splice(e,1),a.innerHTML=""}}}return a.innerHTML='<div class="error-message">Invalid vivaldi video URL format. Expected: "channel:serial"</div>',null}if("iframe"===s){const e=document.createElement("div");return e.className="iframe-container",e.innerHTML=`<iframe src="${o}" allowfullscreen></iframe>`,a.appendChild(e),l&&!isNaN(u)&&ve(a,l,u,m,o,s,he.LINK),{dispose:function(){a.innerHTML=""}}}if("youtube"===s){const e=document.createElement("div");e.className="iframe-container";const t=function(e){const t=/^(?:https?:\/\/)?(?:www\.)?youtube\.com\/live\/([^#&?]*).*/,n=e.match(t);if(n&&n[1]&&11===n[1].length)return n[1];const o=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,a=e.match(o);return a&&11===a[2].length?a[2]:null}(o);if(t){const n=(null!==r?r:y.autoplay)?"1":"0";return e.innerHTML=`<iframe src="https://www.youtube.com/embed/${t}?autoplay=${n}&mute=1" allowfullscreen></iframe>`,a.appendChild(e),l&&!isNaN(u)&&ve(a,l,u,m,o,s,he.YOUTUBE),{dispose:function(){a.innerHTML=""}}}}if("link"===s){const t=document.createElement("div");t.className="d-flex justify-content-center align-items-center link-container";const n=document.createElement("a");return n.href=o,n.target="_blank",n.rel="noopener noreferrer",n.className="btn btn-primary btn-lg",n.innerHTML=`\n        <i class="bi bi-box-arrow-up-right me-2"></i>\n        ${e("buttons.externalLink")}\n      `,t.appendChild(n),a.appendChild(t),l&&!isNaN(u)&&ve(a,l,u,m,o,s,he.LINK),{dispose:function(){a.innerHTML=""}}}const p=function(e){if(!e||!e.includes("-"))return null;const t=e.split("-");if(t.length<2)return null;let n=t[0],o=parseInt(t[1]);"quad"===t[0]&&t.length>=3?(n=t[1],o=parseInt(t[2])):3===t.length&&"grid"===t[1]&&(o=parseInt(t[2]));if(isNaN(o))return null;const a=f.find((e=>e.id===n));if(!a)return null;const i=a.links||a.webcams||[];return i[o]?{resort:a,webcam:i[o]}:null}(i);let h=null;p&&p.webcam&&p.webcam.link&&(h=p.webcam.link),a.innerHTML=`\n      <video\n        id="webcam-player-${i}"\n        class="video-js vjs-theme-forest vjs-big-play-centered"\n        controls\n        ${y.autoplay?"autoplay":""}\n        muted\n        playsinline\n        preload="auto"\n        crossorigin="anonymous"\n      >\n        <source src="${o}" type="application/x-mpegURL">\n        <p class="vjs-no-js">\n          최신 브라우저를 사용하세요.\n        </p>\n      </video>\n    `;try{const c=null!==r?r:y.autoplay,d=videojs(`webcam-player-${i}`,{autoplay:c,muted:!0,controls:!0,preload:"auto",fluid:!0,html5:{hls:{enableLowInitialPlaylist:!0,smoothQualityChange:!0,overrideNative:!0},nativeVideoTracks:!1,nativeAudioTracks:!1},controlBar:{captionsButton:!1,pictureInPictureToggle:!1},notSupportedMessage:e("errors.videoPlayback")}),h=document.createElement("button");if(h.className="capture-button",h.innerHTML=`\n        <i class="bi bi-camera"></i>\n        ${e("buttons.capture")}\n      `,h.addEventListener("click",(()=>function(o){try{const a=document.createElement("canvas"),i=o.el().querySelector("video");if(i.readyState<2)return void ge(o.el(),e("errors.videoNotLoaded"),"warning");a.width=i.videoWidth,a.height=i.videoHeight;a.getContext("2d").drawImage(i,0,0,a.width,a.height);const s=o.el().id;let r,c;if(s){const i=s.replace("webcam-player-","").split("-");if(i.length>=2){"quad"===i[0]&&i.length>=3?(r=i[1],c=parseInt(i[2])):"grid"===i[1]?(r=i[0],c=parseInt(i[2])):(r=i[0],c=parseInt(i[1]));const s=f.find((e=>e.id===r));if(s&&!isNaN(c)){const i=s.links||s.webcams||[];if(i[c]){const r=Ee(t(s)),l=Ee(n(s,c,i[c].name)||`Camera ${c+1}`),d=`capture_${r}_${l}_${we()}.jpg`;Le(a.toDataURL("image/jpeg"),d);return void ge(o.el().parentNode,e("messages.captureSuccess"),"success")}}}}const l=ye(o.el()),d=be(o.el()),u=`capture_${l}_${d}_${we()}.jpg`;Le(a.toDataURL("image/jpeg"),u);const m=o.el().parentNode;showSuccessMessage(m)}catch(t){console.error("Error capturing frame:",t),alert(e("errors.captureError"))}}(d))),a.appendChild(h),document.pictureInPictureEnabled||document.exitPictureInPicture&&document.requestPictureInPicture){const e=document.createElement("button");e.className="pip-button",e.innerHTML='\n          <i class="bi bi-pip"></i>\n          PIP\n        ',e.addEventListener("click",(()=>function(e){const t=e.el().querySelector("video");if(!t)return;document.pictureInPictureElement?document.exitPictureInPicture().catch((e=>{console.error("Error exiting Picture-in-Picture mode:",e)})):(document.pictureInPictureEnabled||t.requestPictureInPicture)&&t.requestPictureInPicture().catch((e=>{console.error("Error entering Picture-in-Picture mode:",e)}))}(d))),a.appendChild(e)}return l&&!isNaN(u)&&ve(a,l,u,m,o,s,he.DEFAULT),d.on("error",(function(){const t=d.error();console.error("Video player error:",t);let n=null;if(p&&p.webcam)n=p.webcam.link||null;else{const e=f.find((e=>e.id===l));if(e){const t=e.links||e.webcams||[];t[u]&&t[u].link&&(n=t[u].link)}}let r=`<div class="error-message"><p>${e("errors.videoPlayback")}</p>`;r+='<div class="d-flex justify-content-center gap-2 mt-3 flex-wrap">',n&&(r+=`\n            <a href="${n}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">\n              <i class="bi bi-box-arrow-up-right me-2"></i>\n              ${e("buttons.originalLink")}\n            </a>`),r+=`\n          <button class="btn btn-secondary retry-button">\n            <i class="bi bi-arrow-clockwise me-2"></i>\n            ${e("buttons.retry")}\n          </button>`,r+="</div>",r+="</div>",a.innerHTML=r,l&&!isNaN(u)&&ve(a,l,u,m,o,s,he.ERROR);const c=a.querySelector(".retry-button");c&&c.addEventListener("click",(function(e){e.preventDefault(),console.log("Retrying video load:",i),fe(o,a,i,s)}))})),d}catch(e){return console.error("Error creating video player:",e),a.innerHTML='<div class="error-message">비디오 플레이어를 생성하는 중 오류가 발생했습니다.</div>',l&&!isNaN(u)&&ve(a,l,u,m,o,s,he.ERROR),null}}const he={ERROR:1,LINK:2,YOUTUBE:3,VIVALDI:4,DEFAULT:0};function ve(t,n,o,a,i,s,r=he.DEFAULT){if("string"==typeof n&&n.includes("favorite-player"))return;if(t.querySelector(".bookmark-button"))return;const c=document.createElement("button");c.className="bookmark-button",c.setAttribute("data-resort-id",n),c.setAttribute("data-webcam-index",o),c.innerHTML=`\n      <span class="bookmark-icon"><i class="bi bi-bookmark"></i></span>\n      ${e("buttons.bookmark")}\n    `,c.addEventListener("click",(function(){K(n,o,a,i,s)})),r===he.ERROR?c.classList.add("bookmark-button-error"):r===he.LINK?c.classList.add("bookmark-button-link"):r===he.YOUTUBE?c.classList.add("bookmark-button-youtube"):r===he.VIVALDI&&c.classList.add("bookmark-button-vivaldi"),t.appendChild(c)}function ge(e,t,n="success"){const o=document.createElement("div");o.className=`alert alert-${n} position-absolute top-0 start-50 translate-middle-x mt-3 toast-message`,o.textContent=t,e.appendChild(o),setTimeout((()=>{o.classList.add("fade-out"),setTimeout((()=>{o.remove()}),500)}),2e3)}function ye(e){if(e){const t=e.closest(".favorite-card");if(t){const e=t.querySelector(".favorite-resort");if(e&&e.textContent)return Ee(e.textContent.trim())}}const n=document.querySelector(".content-section.active .resort-label");if(n&&n.textContent)return Ee(n.textContent.trim());const o=window.location.hash.substring(1);if(o){const e=o.split("/")[0],n=f.find((t=>t.id===e));if(n)return Ee(t(n))}const a=document.querySelector(".menu-item.active");if(a){return Ee(a.textContent.trim().split("\n")[0])}return"unknown"}function be(e){const t=e.closest(".video-container, .quad-video");if(!t)return"unknown";const o=t.closest(".favorite-card");if(o){const e=o.querySelector(".favorite-location");if(e&&e.textContent)return Ee(e.textContent.trim())}const a=t.querySelector(".vjs-tech")||t.querySelector("iframe")||t.querySelector(".vivaldi-container");if(a&&a.id){const e=a.id.match(/player-([^-]+)-(\d+)/)||a.id.match(/player-([^-]+)-grid-(\d+)/);if(e&&e.length>=3){const t=e[1],o=parseInt(e[2]),a=f.find((e=>e.id===t));if(a){const e=a.links||a.webcams||[];if(e[o])return Ee(n(a,o,e[o].name))}}}const i=document.querySelector(".submenu-item.active");if(i&&!i.classList.contains("submenu-item-status"))return Ee(i.textContent.trim());const s=document.querySelector(".content-section.active .inline-title.inline-title-submenu");if(s&&s.textContent)return Ee(s.textContent.trim());const r=window.location.hash.substring(1);if(r){const e=r.split("/");if(e.length>1){const t=e[0],o=e[1];if(t&&o&&!isNaN(parseInt(o))){const e=f.find((e=>e.id===t));if(e){const t=e.links||e.webcams||[],a=parseInt(o);if(t[a])return Ee(n(e,a,t[a].name))}}}}const c=e.closest(".video-card");if(c){const e=c.querySelector("h3");if(e)return Ee(e.textContent.trim())}return"webcam"}function we(){const e=new Date;return`${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}_${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`}function Ee(e){return e.replace(/[^가-힣\w\s,()-]/g,"").replace(/\s+/g,"_")}function Le(e,t){if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)&&navigator.canShare&&navigator.share)try{const n=e.split(","),o=n[0].match(/:(.*?);/)[1],a=atob(n[1]);let i=a.length;const s=new Uint8Array(i);for(;i--;)s[i]=a.charCodeAt(i);const r=new File([s],t,{type:o});if(navigator.canShare({files:[r]}))return void navigator.share({files:[r],title:t}).catch((n=>{"AbortError"!==n.name&&(console.error("Sharing failed:",n),Ce(e,t))}))}catch(e){console.error("Error preparing share:",e)}Ce(e,t)}function Ce(e,t){const n=document.createElement("a");n.href=e,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function ke(){window.innerWidth<=768&&(i.classList.remove("active"),s.classList.remove("active"))}function Se(){fetch("weather.grid.json?v="+(new Date).getTime()).then((e=>{if(!e.ok)throw new Error("Failed to load forecast data");return e.json()})).then((n=>{!function(n){const o=document.getElementById("forecast");if(!o)return;o.innerHTML="";const a=document.createElement("div");a.className="forecast-header";const i=new Date(n.last_fetch_time);a.innerHTML=`<h4>5일 예보 <small>(${i.toLocaleDateString("ko-KR")} ${i.toLocaleTimeString("ko-KR")} 업데이트)</small></h4>`,o.appendChild(a);const s={temperature:"rgb(255, 99, 132)",wind:"rgb(54, 162, 235)",snowfall:"rgb(153, 102, 255)"},r=new Date,c=[];for(let e=0;e<=120;e+=3){const t=new Date(r.getTime()+60*e*60*1e3);c.push(t)}const l=f.filter((e=>e.name)),d=document.createElement("div");d.className="chart-grid",o.appendChild(d);const u=n.weathers;console.log("Weather data structure:",{lastFetchTime:n.last_fetch_time,weathersCount:u.length,sampleData:u[0]||null}),l.forEach((n=>{const o=n.name,a=t(n),i=u.find((e=>e&&"object"==typeof e&&e.resort===o));if(!i)return void console.error(`No forecast data found for resort ${o}`);const c=document.createElement("div");c.className="chart-container";const l=document.createElement("div");l.className="chart-header";const m=document.createElement("h4");if(m.textContent=a,l.appendChild(m),!i.forecasts){console.error(`Invalid data format for resort ${o}:`,i);const t=document.createElement("div");return t.className="alert alert-warning",t.textContent=e("errors.loadForecast"),c.appendChild(t),void d.appendChild(c)}const p=i.forecasts.filter((e=>e&&"object"==typeof e));if(p.length>0&&console.log(`Sample forecast for ${o}:`,p[0]),0===p.length){console.error(`No valid forecasts for resort ${o}`);const t=document.createElement("div");return t.className="alert alert-warning",t.textContent=e("errors.loadForecast"),c.appendChild(t),void d.appendChild(c)}const f=Math.max(...p.map((e=>e.temp||-1/0))),h=Math.min(...p.map((e=>e.temp||1/0))),v=p.reduce(((e,t)=>e+(t.snow_3h||0)),0),g=document.createElement("div");g.className="forecast-summary",g.innerHTML=`\n        <span class="temp-range">${e("forecast.temperature")}: ${h.toFixed(1)}°C ~ ${f.toFixed(1)}°C</span>\n        <span class="total-snow">${e("forecast.totalSnowfall")}: ${v.toFixed(1)}cm</span>\n      `,l.appendChild(g),c.appendChild(l);const y=document.createElement("canvas");y.id=`chart-${n.id}`,c.appendChild(y),d.appendChild(c);const b=[],w=[],E=[],L=[];p.sort(((e,t)=>new Date(e.timestamp)-new Date(t.timestamp))),p.forEach((e=>{if(e&&e.timestamp){const t=new Date(e.timestamp);t>r&&t<new Date(r.getTime()+432e6)&&(L.push(t),b.push(e.temp),w.push(e.wind_speed),E.push(e.snow_3h||0))}})),Chart.defaults.color="#e0e0e0",Chart.defaults.borderColor="rgba(255, 255, 255, 0.1)",new Chart(y,{type:"line",data:{labels:L,datasets:[{label:e("forecast.tempLabel"),data:b,borderColor:s.temperature,backgroundColor:s.temperature+"33",borderWidth:2,yAxisID:"y",tension:.3,pointRadius:3,pointHoverRadius:5,fill:!1,spanGaps:!0},{label:e("forecast.windLabel"),data:w,borderColor:s.wind,backgroundColor:s.wind+"33",borderWidth:2,yAxisID:"y1",tension:.3,pointRadius:3,pointHoverRadius:5,fill:!1,spanGaps:!0},{label:e("forecast.snowLabel"),data:E,borderColor:s.snowfall,backgroundColor:s.snowfall+"33",borderWidth:2,yAxisID:"y2",tension:.3,pointRadius:3,pointHoverRadius:5,fill:!1,spanGaps:!0}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{tooltip:{callbacks:{title:function(e){const t=new Date(e[0].parsed.x),n="ko"===i18n.getLanguage()?"ko-KR":"en-US";return t.toLocaleDateString(n)+" "+t.toLocaleTimeString(n,{hour:"2-digit",minute:"2-digit"})}},backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1},legend:{position:"top",labels:{usePointStyle:!0,padding:15,color:"#e0e0e0",font:{weight:"bold"}}}},scales:{x:{type:"time",time:{unit:"day",displayFormats:{day:"M/d"},tooltipFormat:"ko"===i18n.getLanguage()?"yyyy년 MM월 dd일 HH:mm":"MMM d, yyyy HH:mm"},title:{display:!0,text:e("forecast.dateTime"),color:"#e0e0e0",font:{weight:"bold"}},ticks:{maxRotation:0,color:"#e0e0e0"},grid:{color:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)"}},y:{type:"linear",display:!0,position:"left",title:{display:!0,text:e("forecast.tempLabel"),color:s.temperature,font:{weight:"bold"}},suggestedMin:h-5,suggestedMax:f+5,ticks:{color:"#e0e0e0"},grid:{color:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)"}},y1:{type:"linear",display:!0,position:"right",title:{display:!0,text:e("forecast.windLabel"),color:s.wind,font:{weight:"bold"}},grid:{drawOnChartArea:!1,color:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)"},ticks:{color:"#e0e0e0"}},y2:{type:"linear",display:!0,position:"right",title:{display:!0,text:e("forecast.snowLabel"),color:s.snowfall,font:{weight:"bold"}},grid:{drawOnChartArea:!1,color:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)"},suggestedMin:0,suggestedMax:1.5*Math.max(...E)||10,ticks:{color:"#e0e0e0"}}}}})})),0===d.children.length&&(o.innerHTML='<div class="alert alert-info">예보 데이터가 없습니다.</div>')}(n)})).catch((t=>{console.error("Error loading forecast data:",t);const n=document.getElementById("forecast");n&&(n.innerHTML=`<div class="alert alert-danger">${e("errors.loadForecast")}</div>`)}))}let Ne;function Ie(){Ne&&cancelAnimationFrame(Ne),Ne=requestAnimationFrame(qe)}function qe(){if(!y.autoplay||document.hidden)return;l=l.filter((e=>{const t=e.el();return t&&document.body.contains(t)})),d=d.filter((e=>{const t=e.el();return t&&document.body.contains(t)}));const e=[...l,...d],t=e.map((e=>{const t=e.el().getBoundingClientRect(),n=Math.min(t.bottom,window.innerHeight)-Math.max(t.top,0);return{player:e,rect:t,visible:(t.height>0?Math.max(0,n)/t.height:0)>.3,top:t.top}})).filter((e=>e.visible));t.sort(((e,t)=>e.top-t.top));const n=v?4:9,o=t.slice(0,n).map((e=>e.player));e.forEach((e=>{if(o.includes(e)){if(e.paused()){const t=e.play();void 0!==t&&"function"==typeof t.catch&&t.catch((()=>{}))}}else e.paused()||e.pause()}))}a.addEventListener("click",(function(){i.classList.toggle("active"),s.classList.toggle("active")})),s.addEventListener("click",ke),window.addEventListener("resize",(function(){v=window.innerWidth<=768,window.innerWidth>768&&(i.classList.remove("active"),s.classList.remove("active"))})),window.addEventListener("hashchange",me),window.addEventListener("scroll",Ie,{passive:!0}),window.addEventListener("resize",Ie,{passive:!0}),document.addEventListener("visibilitychange",(function(){document.hidden?(l.forEach((e=>{e.paused()||e.pause()})),d.forEach((e=>{e.paused()||e.pause()}))):qe()}));const $e=document.getElementById("bugReportButton"),xe=document.getElementById("bugReportModal"),Te=document.getElementById("closeBugReportModal"),Ae=document.getElementById("bugReportForm");$e&&xe&&($e.addEventListener("click",(function(){xe.classList.add("active")})),Te.addEventListener("click",(function(){xe.classList.remove("active")})),window.addEventListener("click",(function(e){e.target===xe&&xe.classList.remove("active")})),Ae.addEventListener("submit",(async function(t){t.preventDefault();const n=document.getElementById("reportType").value,o=document.getElementById("reportTitle").value,a=document.getElementById("reportContent").value,i=Ae.querySelector(".submit-button");i.disabled=!0,i.textContent=e("bugReport.submitting");try{const t={recaptchaResponse:await grecaptcha.execute("6LdnzyUsAAAAAKh6eSEaERifPRTh51qnRnpmX6S0",{action:"submit"}),type:n,title:o,content:a},i=await fetch("report.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await i.json();s.success?(alert(e("bugReport.submitted")),xe.classList.remove("active"),Ae.reset()):(alert(e("bugReport.submitFailed")+": "+(s.error||"error")),console.error("Server Error:",s))}catch(t){console.error("Error:",t),alert(e("bugReport.submitError"))}finally{i.disabled=!1,i.textContent=e("bugReport.submit")}}))),function(){let o=Promise.resolve(null);window.location.hash&&(o=fetch("weather.json?v="+(new Date).getTime()).then((e=>e.ok?e.json():(console.warn("Weather data not available"),null))).then((e=>e?(h=e,e):null)).catch((e=>(console.error("Error loading weather data:",e),null)))),fetch("links.json?v="+(new Date).getTime()).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((a=>{if(Array.isArray(a)&&a.length>0)return function(o){f=o,F(),i.innerHTML='<div class="site-title"><a href="./">Slopes cam</a></div>',document.getElementById("default-message"),Array.from(document.querySelectorAll(".content-section:not(#default-message)")).forEach((e=>e.remove()));const a=document.createElement("div");a.className="menu-item-container";const s=document.createElement("div");s.className="menu-item",s.setAttribute("data-target","misc"),s.setAttribute("data-has-submenu","true"),s.textContent=e("nav.usefulFeatures"),a.appendChild(s);const d=document.createElement("span");d.className="dropdown-toggle",d.innerHTML='<i class="bi bi-chevron-down"></i>',d.setAttribute("aria-label","Toggle submenu"),s.appendChild(d),d.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();const t=a.querySelector(".submenu");if(t){const e=t.classList.contains("active");re(),e||(t.classList.add("active"),s.classList.add("active"),this.innerHTML='<i class="bi bi-chevron-up"></i>')}}));const u=document.createElement("div");u.className="submenu",u.id="misc-submenu",a.appendChild(u);const h=document.createElement("div");h.className="submenu-item",h.setAttribute("data-target","misc-forecast"),h.textContent=e("nav.forecast"),u.appendChild(h);const v=document.createElement("div");v.className="content-section",v.id="misc-forecast";const g=document.createElement("h2");g.textContent=e("nav.forecast"),g.className="inline-title",v.appendChild(g);const y=document.createElement("div");y.className="misc-content",y.innerHTML='\n      <div class="forecast-container">\n        <div id="forecast"></div>\n      </div>\n    ',v.appendChild(y),r.appendChild(v),h.addEventListener("click",(function(){document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")})),this.classList.add("active"),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const t=document.getElementById("default-message");t.classList.remove("active"),t.style.display="none",v.classList.add("active"),window.location.hash="misc/forecast",document.title=`${c} - ${e("nav.forecast")}`,se(),Se(),ke()}));const b=document.createElement("div");b.className="content-section",b.id="misc";const w=document.createElement("h2");w.textContent=e("nav.usefulFeatures"),w.className="inline-title",b.appendChild(w);const E=document.createElement("div");E.className="misc-content",E.innerHTML=`\n      <p>${e("nav.selectFromMenu")}</p>\n    `,b.appendChild(E),r.appendChild(b),s.addEventListener("click",(function(t){if(t.target.classList.contains("dropdown-toggle")||t.target.closest(".dropdown-toggle"))return;document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".submenu-item").forEach((e=>e.classList.remove("active"))),this.classList.add("active"),re(),de(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const n=document.getElementById("default-message");n.classList.remove("active"),n.style.display="none";const o=document.getElementById("misc-submenu");if(o){o.classList.add("active"),this.classList.add("active");const e=this.querySelector(".dropdown-toggle");e&&(e.innerHTML='<i class="bi bi-chevron-up"></i>')}const a=document.getElementById("misc");a&&a.classList.add("active"),window.location.hash="misc",document.title=`${c} - ${e("nav.usefulFeatures")}`,ke()})),o.forEach((o=>{const a=o.id,s=t(o),c=o.links||o.webcams||[],d=c.length>0;if(0===c.length)return;const u=document.createElement("div");u.className="menu-item-container";const f=document.createElement("div");if(f.className="menu-item",f.setAttribute("data-target",a),d&&(f.setAttribute("data-has-submenu","true"),f.setAttribute("data-resort-id",a)),f.textContent=s,u.appendChild(f),d){const e=document.createElement("span");e.className="dropdown-toggle",e.innerHTML='<i class="bi bi-chevron-down"></i>',e.setAttribute("aria-label","Toggle submenu"),f.appendChild(e),e.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();const t=u.querySelector(".submenu");if(t){const e=t.classList.contains("active");re(),e||(t.classList.add("active"),f.classList.add("active"),this.innerHTML='<i class="bi bi-chevron-up"></i>')}}))}i.appendChild(u);const h=document.createElement("div");h.className="content-section",h.id=d?`${a}-main`:a;const v=document.createElement("h2");if(v.textContent=s,v.className="inline-title",h.appendChild(v),r.appendChild(h),d){const t=document.createElement("div");if(t.className="submenu",t.id=`${a}-submenu`,u.appendChild(t),o.status){const n=document.createElement("div");n.className="submenu-item submenu-item-status",n.innerHTML=`${e("nav.openStatus")} <i class="bi bi-box-arrow-up-right me-1"></i>`,t.appendChild(n),n.addEventListener("click",(function(){window.open(o.status,"_blank","noopener,noreferrer")}))}c.forEach(((e,i)=>{const d=n(o,i,e.name);if(!d)return;const u=document.createElement("div");u.className="submenu-item",u.setAttribute("data-target",`${a}-webcam-${i}`),u.setAttribute("data-webcam-index",i),u.textContent=d,t.appendChild(u);const m=document.createElement("div");m.className="content-section",m.id=`${a}-webcam-${i}`;const f=document.createElement("h2");f.textContent=d,f.className="inline-title inline-title-submenu cursor-pointer",f.addEventListener("click",(function(){const e=document.querySelector(`#${a}-submenu .submenu-item[data-webcam-index="${i}"]`);e&&e.click()})),m.appendChild(f);const h=document.createElement("span");h.textContent=s,h.className="resort-label",m.appendChild(h);const v=document.createElement("div");v.className="video-container",m.appendChild(v),r.appendChild(m),u.addEventListener("click",(function(){const e=this.getAttribute("data-webcam-index");p=e,ce(a,e),le(a,e),document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")})),this.classList.add("active"),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const t=document.getElementById("default-message");t.classList.remove("active"),t.style.display="none";const n=document.getElementById(this.getAttribute("data-target"));if(n){n.classList.add("active"),de();const t=n.querySelector(".video-container");if(t&&c[e]){const n=c[e].video||c[e].link;if(n){const o=fe(n,t,`${a}-${e}`,c[e].video_type);o&&l.push(o),ue(a)}else t.innerHTML='<div class="error-message">No video stream available</div>'}}ke()}))}))}f.addEventListener("click",(function(e){if(e.target.classList.contains("dropdown-toggle")||e.target.closest(".dropdown-toggle"))return;const t=this.getAttribute("data-target"),n="true"===this.getAttribute("data-has-submenu"),o=this.getAttribute("data-resort-id");if(o&&(m=o,p=null),ce(t),le(t,null),document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".submenu-item").forEach((e=>e.classList.remove("active"))),this.classList.add("active"),re(),n){const e=document.getElementById(`${t}-submenu`);if(e){e.classList.add("active"),this.classList.add("active");const t=this.querySelector(".dropdown-toggle");t&&(t.innerHTML='<i class="bi bi-chevron-up"></i>')}}de(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const a=document.getElementById("default-message");if(a.classList.remove("active"),a.style.display="none",n){const e=document.getElementById(`${t}-main`);e&&(e.classList.add("active"),pe(t))}else{const e=document.getElementById(t);e&&e.classList.add("active")}ue(t),ke()}))})),!window.location.hash&&f.length>0||window.location.hash&&me()}(a),o.then((e=>e||fetch("weather.json?v="+(new Date).getTime()).then((e=>e.ok?e.json():(console.warn("Weather data not available"),null)))));throw new Error("Invalid data format")})).then((e=>{if(e){if(h=e,console.log("Weather data loaded:",h.length,"locations"),window.location.hash){const e=window.location.hash.substring(1).split("/")[0];e&&ue(e)}se()}window.location.hash?me():G()})).catch((t=>{console.error("Error initializing app:",t);const n=document.getElementById("default-message");n?(n.innerHTML=`<div class="error-message p-5 text-center"><h3>${e("errors.loadResortInfo")}</h3><p>${e("errors.refreshPage")}</p></div>`,n.classList.add("active")):r.innerHTML=`<div class="error-message">${e("errors.loadResortInfo")}</div>`}))}()}));