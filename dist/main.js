"serviceWorker"in navigator&&window.addEventListener("load",(function(){"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?navigator.serviceWorker.getRegistrations().then((function(e){for(let t of e)t.unregister()})):navigator.serviceWorker.register("./service-worker.js").then((function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)})).catch((function(e){console.log("ServiceWorker registration failed: ",e)}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".toggle-menu"),t=document.querySelector(".sidebar"),n=document.querySelector(".sidebar-backdrop"),o=document.querySelector(".main-content"),a="Slopes cam";let i=[],s=[null,null,null,null],c=null,r=null,l=[],d=[],u=window.innerWidth<=768,m=function(){try{const e=localStorage.getItem("webcamFavorites");return e?JSON.parse(e):[]}catch(e){return console.error("Error loading favorites:",e),[]}}(),p=function(){try{const e=localStorage.getItem("webcamSettings");if(e){const t=JSON.parse(e);return void 0===t.autoplay&&(t.autoplay=!u),void 0===t.darkMode&&(t.darkMode=!0),t}}catch(e){console.error("Error loading settings:",e)}return{autoplay:!u,darkMode:!0,quadViewOpen:!1}}(),f=function(){try{const e=localStorage.getItem("quadViewSelections");if(e){const t=JSON.parse(e);if(Array.isArray(t)){for(;t.length<4;)t.push("");return t.slice(0,4).map((e=>"string"==typeof e?e:""))}}}catch(e){console.error("Error loading quad selections:",e)}return["","","",""]}();function h(){try{localStorage.setItem("webcamSettings",JSON.stringify(p))}catch(e){console.error("Error saving settings:",e)}}function v(){try{localStorage.setItem("quadViewSelections",JSON.stringify(f))}catch(e){console.error("Error saving quad selections:",e)}}function g(){!1===p.darkMode?(document.body.classList.add("light-mode"),document.documentElement.setAttribute("data-theme","light")):(document.body.classList.remove("light-mode"),document.documentElement.setAttribute("data-theme","dark")),B()}const y=document.getElementById("settingsButton"),b=document.getElementById("settingsModal"),w=document.getElementById("closeSettingsModal"),E=document.getElementById("autoplayToggle"),L=document.getElementById("themeToggle");g(),E.checked=p.autoplay,L&&(L.checked=!1!==p.darkMode),E.addEventListener("change",(function(){p.autoplay=this.checked,h()})),L&&L.addEventListener("change",(function(){p.darkMode=this.checked,g(),h()})),y.addEventListener("click",(function(){b.style.display="block"})),w.addEventListener("click",(function(){b.style.display="none"})),window.addEventListener("click",(function(e){e.target===b&&(b.style.display="none")}));const C=document.getElementById("infoButton"),k=document.getElementById("infoModal"),S=document.getElementById("closeInfoModal");C.addEventListener("click",(function(){k.style.display="flex"})),S.addEventListener("click",(function(){k.style.display="none"})),window.addEventListener("click",(function(e){e.target===k&&(k.style.display="none")}));const N=document.getElementById("addToHomeButton"),q=document.getElementById("installationModal"),I=document.getElementById("closeModal"),x=document.getElementById("quadViewButton"),$=document.getElementById("quadViewContainer"),A=document.getElementById("quadBackButton"),T=Array.from(document.querySelectorAll(".quad-select")),M=Array.from(document.querySelectorAll(".quad-video"));function H(e,t,n=!1){const o=M[e];if(!o)return;if(s[e]&&"function"==typeof s[e].dispose&&s[e].dispose(),s[e]=null,o.innerHTML="",!t)return f[e]="",void(n||v());const[a,i]=t.split("||"),c=parseInt(i,10),r=l.find((e=>e.id===a));if(!r||isNaN(c))return;const d=(r.links||r.webcams||[])[c];if(!d)return;const u=d.video||d.link;if(!u)return;const m=re(u,o,`quad-${a}-${c}`,d.video_type,!0);m&&(s[e]=m),f[e]=t,n||v()}function B(){const e=document.getElementById("quadViewPage");e&&(!1===p.darkMode?e.classList.add("light-mode"):e.classList.remove("light-mode"))}function D(){if(!Array.isArray(l)||0===l.length)return;if(window.quadSelectsInitialized)return;window.quadSelectsInitialized=!0;const e=document.querySelectorAll(".custom-dropdown");document.addEventListener("click",(function(e){e.target.closest(".custom-dropdown")||document.querySelectorAll(".custom-dropdown").forEach((e=>e.classList.remove("active")))})),e.forEach(((e,t)=>{const n=e.querySelector(".dropdown-trigger"),o=(e.querySelector(".dropdown-menu"),e.querySelector(".dropdown-search")),a=e.querySelector(".dropdown-list"),i=parseInt(e.getAttribute("data-slot"));function s(e){a.querySelectorAll(".dropdown-item");a.querySelectorAll(".dropdown-group").forEach((t=>{let n=!1;const o=t.querySelectorAll(".dropdown-item");o.forEach((t=>{t.textContent.toLowerCase().includes(e)?(t.style.display="flex",n=!0):t.style.display="none"}));const a=t.querySelector(".dropdown-group-header");a&&(a.textContent.toLowerCase().includes(e)&&o.forEach((e=>{e.style.display="flex",n=!0})),a.style.display=n?"block":"none")}))}n.addEventListener("click",(function(){const t=e.classList.contains("active");document.querySelectorAll(".custom-dropdown").forEach((e=>e.classList.remove("active"))),t||(e.classList.add("active"),o.value="",s(""),o.focus())})),o.addEventListener("input",(function(e){s(e.target.value.toLowerCase())})),a.innerHTML="";const c=document.createElement("div");c.className="dropdown-group";const r=document.createElement("div");function d(t,o){n.textContent=o,e.classList.remove("active"),a.querySelectorAll(".dropdown-item").forEach((e=>e.classList.remove("selected")));const s=a.querySelector(`.dropdown-item[data-value="${t}"]`);s&&s.classList.add("selected"),H(i,t)}r.className="dropdown-item",r.textContent="선택 안 함",r.dataset.value="",r.addEventListener("click",(()=>d("","카메라 선택"))),c.appendChild(r),a.appendChild(c),l.forEach((e=>{const t=e.links||e.webcams||[];if(0===t.length)return;const n=document.createElement("div");n.className="dropdown-group";const o=document.createElement("div");o.className="dropdown-group-header",o.textContent=e.name,n.appendChild(o),t.forEach(((t,o)=>{if(!(t.video||t.link))return;const a=document.createElement("div");a.className="dropdown-item",a.innerHTML=`<i class="bi bi-camera-video"></i> ${t.name||`카메라 ${o+1}`}`,a.dataset.value=`${e.id}||${o}`,a.addEventListener("click",(()=>{const n=`${e.name} - ${t.name||`카메라 ${o+1}`}`;d(a.dataset.value,n)})),n.appendChild(a)})),a.appendChild(n)}));const u=f[t]||"";if(u){const[e,o]=u.split("||"),i=l.find((t=>t.id===e));if(i){const e=(i.links||i.webcams||[])[parseInt(o)];if(e){const s=`${i.name} - ${e.name||`카메라 ${parseInt(o)+1}`}`;n.textContent=s,setTimeout((()=>{const e=a.querySelector(`.dropdown-item[data-value="${u}"]`);e&&e.classList.add("selected")}),0),H(t,u,!0)}}}else H(t,"",!0)}))}function _(e=!1){$&&($.classList.add("active"),document.body.classList.add("quad-view-open"),ae(),D(),B(),e&&(window.location.hash="quad"),p.quadViewOpen=!0,h())}function R(e=!1){$&&($.classList.remove("active"),document.body.classList.remove("quad-view-open"),s.forEach(((e,t)=>{if(e&&"function"==typeof e.dispose)try{e.dispose()}catch(e){console.error("Error disposing quad player",e)}s[t]=null})),M.forEach((e=>{e.innerHTML=""})),e&&"#quad"===window.location.hash&&(window.location.hash=""),p.quadViewOpen=!1,h())}N.addEventListener("click",(function(){q.style.display="block",setTimeout((function(){q.classList.add("active")}),10)})),I.addEventListener("click",(function(){q.classList.remove("active"),setTimeout((function(){q.style.display="none"}),400)})),q.addEventListener("click",(function(e){e.target===q&&I.click()})),function(){const e=[document.getElementById("addToHomeButton"),document.getElementById("settingsButton"),document.getElementById("quadViewButton")],t=document.querySelector(".floating-button-group");t&&e.forEach((e=>{e&&t.appendChild(e)}))}(),p.quadViewOpen&&_(!0),x&&x.addEventListener("click",(function(){_(!0)})),A&&A.addEventListener("click",(function(){R(!0)}));const P=document.getElementById("quadAddToHomeButton");function j(){try{localStorage.setItem("webcamFavorites",JSON.stringify(m))}catch(e){console.error("Error saving favorites:",e)}}function W(e,t,n,o,a){const i=m.findIndex((n=>n.resortId===e&&n.webcamIndex===t));-1===i?m.push({resortId:e,webcamIndex:t,webcamName:n,resortName:l.find((t=>t.id===e))?.name||"",videoUrl:o,videoType:a}):m.splice(i,1),j(),O(),U()}function O(){document.querySelectorAll(".bookmark-button").forEach((e=>{!function(e,t){return m.some((n=>n.resortId===e&&n.webcamIndex===t))}(e.getAttribute("data-resort-id"),parseInt(e.getAttribute("data-webcam-index")))?(e.classList.remove("active"),e.querySelector(".bookmark-icon").innerHTML='<i class="bi bi-bookmark"></i>'):(e.classList.add("active"),e.querySelector(".bookmark-icon").innerHTML='<i class="bi bi-bookmark-fill"></i>')}))}function U(){const e=document.getElementById("favorites-container"),t=document.getElementById("favorites-grid");if(e&&t){if(0===m.length){const t=document.createElement("div");t.className="instruction",t.innerHTML="<p>북마크한 영상이 없습니다. 영상 오른쪽 위의 북마크 버튼을 눌러 영상을 추가해 보세요.<br>북마크는 같은 브라우저에서만 저장됩니다.</p>",e.appendChild(t)}if(e.style.display="block",t.innerHTML="",""===window.location.hash){const t=e.closest(".content-section");t&&(t.style.display="block")}else{const t=e.closest(".content-section");t&&(t.style.display="none")}i&&i.length>0&&(i=i.filter((e=>{const t=e.el_?.id;return!t||!t.includes("favorite-player")||(e.dispose(),!1)}))),m.forEach(((e,n)=>{const o=document.createElement("div");o.className="video-card favorite-card",o.draggable=!0,o.setAttribute("data-index",n);const a=document.createElement("div");a.className="drag-handle",a.innerHTML='<i class="bi bi-grip-vertical"></i>',o.appendChild(a);const s=document.createElement("div");s.className="favorites-header-container";const c=document.createElement("div");c.className="favorite-header";const r=document.createElement("span");r.className="favorite-location cursor-pointer",r.textContent=e.webcamName,r.addEventListener("click",(function(){const t=`${e.resortId}/${e.webcamIndex}`;window.location.hash=t}));const l=document.createElement("span");l.className="favorite-resort",l.textContent=e.resortName,c.appendChild(r),c.appendChild(l),s.appendChild(c);const d=document.createElement("button");d.className="favorites-remove-button",d.innerHTML='<i class="bi bi-trash"></i>',d.setAttribute("title","북마크 제거"),d.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),W(e.resortId,e.webcamIndex)})),s.appendChild(d),o.appendChild(s);const u=document.createElement("div");if(u.className="video-container",o.appendChild(u),t.appendChild(o),e.videoUrl){const t=`favorite-player-${n}`,o=re(e.videoUrl,u,t,e.videoType);o&&i.push(o)}o.addEventListener("dragstart",z),o.addEventListener("dragover",K),o.addEventListener("dragenter",J),o.addEventListener("dragleave",G),o.addEventListener("drop",Y),o.addEventListener("dragend",Q)})),ee()}else console.error("Favorites container or grid not found")}P&&P.addEventListener("click",(function(){const e=document.getElementById("installationModal");e&&(e.style.display="block",setTimeout((function(){e.classList.add("active")}),10))})),T.forEach(((e,t)=>{e.addEventListener("change",(function(){H(t,this.value)}))}));let V=null,F=-1;function z(e){V=this,F=parseInt(this.getAttribute("data-index")),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.innerHTML),this.classList.add("dragging"),document.querySelectorAll(".favorite-card").forEach((e=>{e!==this&&e.classList.add("drop-target")}))}function K(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function J(e){this.classList.add("drag-over")}function G(e){this.classList.remove("drag-over")}function Y(e){if(e.stopPropagation(),e.preventDefault(),this.classList.remove("drag-over"),V===this)return!1;const t=parseInt(this.getAttribute("data-index"));if(-1!==F&&-1!==t){const e=m[F];m.splice(F,1),m.splice(t,0,e),j(),U()}return!1}function Q(e){document.querySelectorAll(".favorite-card").forEach((e=>{e.classList.remove("dragging","drag-over","drop-target")}))}function X(e,t,n=!1){const o=document.createElement("div");if(o.className="location-name",e.name.startsWith("리조트_")?o.textContent=e.name.replace("리조트_",""):o.textContent=e.name,t){const a=new Date(t);month=a.getMonth()+1,day=a.getDate(),hours=a.getHours().toString().padStart(2,"0"),minutes=a.getMinutes().toString().padStart(2,"0");const i=document.createElement("span");i.className="weather-update-time",i.textContent=`${month}월 ${day}일 ${hours}:${minutes} 기준`,n&&(e.name.startsWith("리조트_")?i.textContent+=" (리조트 제공)":i.textContent+=" (기상청 제공)"),o.appendChild(i)}return o}function Z(e){const t=document.createElement("div");t.className="weather-data";class n{constructor(e,t,n,o,a=1){this.span=document.createElement("span"),this.span.className=e;const i=document.createElement("i");i.className=t,this.span.appendChild(i);const s=Number(n).toFixed(a);return this.span.appendChild(document.createTextNode(`${s}${o}`)),this.span}}if(null!==e.temperature){const o=new n("temperature","bi bi-thermometer-half",e.temperature,"°C");t.appendChild(o)}if(null!==e.humidity){t.appendChild(document.createTextNode(" • "));const o=new n("humidity","bi bi-moisture",e.humidity,"%",0);t.appendChild(o)}if(null!==e.wind_speed){t.appendChild(document.createTextNode(" • "));const o=new n("wind-speed","bi bi-wind",e.wind_speed,"m/s");t.appendChild(o)}if(null!==e.rainfall){t.appendChild(document.createTextNode(" • "));const o=new n("rainfall","bi bi-droplet-fill",e.rainfall,"mm");t.appendChild(o)}if(null!==e.snowfall_3hr){t.appendChild(document.createTextNode(" • "));const o=new n("snowfall","bi bi-snow",e.snowfall_3hr,"cm");t.appendChild(o)}return t}function ee(){if(!d||0===d.length)return;if(!l||0===l.length)return;const e=document.getElementById("default-message");if(!e)return;const t=e.querySelector(".all-resorts-weather");t&&t.remove();const n=document.createElement("div");n.className="all-resorts-weather",n.innerHTML='<h3>전국 스키장 날씨 <span style="font-size: 0.6em; font-weight: normal; color: #999; margin-left: 6px;">기상청 데이터 기준</span></h3>';const o=document.createElement("div");if(o.className="weather-container",n.appendChild(o),l.forEach((e=>{const t=e.name,n=d.find((e=>e.resort===t&&"스키하우스"===e.name));if(n&&n.data&&n.data.length>0){const t=document.createElement("div");t.className="weather-info-wrapper";const a=document.createElement("div");a.className="weather-info";const i=n.data[n.data.length-1],s=X(e,n.timestamp,!1),c=Z(i);a.appendChild(s),a.appendChild(c),t.appendChild(a),o.appendChild(t)}})),o.children.length>0){const t=e.querySelector("#favorites-container");t?t.after(n):e.appendChild(n)}const a=document.createElement("h3");a.style.marginTop="16px",a.textContent="전국 스키장 날씨";const i=document.createElement("span");i.textContent="리조트 데이터 기준",i.style.fontSize="0.6em",i.style.fontWeight="normal",i.style.color="#999",i.style.marginLeft="6px",a.appendChild(i),n.appendChild(a);const s=document.createElement("div");if(s.className="weather-container",n.appendChild(s),l.forEach((e=>{const t=e.name;d.filter((e=>e.resort===t&&e.name.startsWith("리조트_"))).forEach((t=>{if(t&&t.data&&t.data.length>0){const n=document.createElement("div");n.className="weather-info-wrapper";const o=document.createElement("div");o.className="weather-info";const a=t.data[t.data.length-1],i=X(e,t.timestamp,!1),c=Z(a);o.appendChild(i),o.appendChild(c),n.appendChild(o),s.appendChild(n)}}))})),s.children.length>0){const t=e.querySelector("#favorites-container");t?t.after(n):e.appendChild(n)}}function te(){document.querySelectorAll(".submenu").forEach((e=>{e.classList.remove("active")})),document.querySelectorAll('.menu-item[data-has-submenu="true"]').forEach((e=>{e.classList.remove("active")})),document.querySelectorAll(".dropdown-toggle").forEach((e=>{e.innerHTML='<i class="bi bi-chevron-down"></i>'}))}function ne(e,t){const n=t?`${e}/${t}`:e;if(window.location.hash.substring(1)===n)return;const o=new URL(window.location);o.hash=n,history.pushState(null,"",o),oe(e,t)}function oe(e,t){if(!e)return void(document.title=a);const n=l.find((t=>t.id===e));if(n)if(null!=t){const e=parseInt(t),o=n.links||n.webcams||[];if(!isNaN(e)&&o[e]){const t=o[e].name;document.title=`${a} - ${t} - ${n.name}`}else document.title=`${a} - ${n.name}`}else document.title=`${a} - ${n.name}`;else document.title=a}function ae(){i&&i.length>0&&(i.forEach((e=>{e&&"function"==typeof e.dispose&&e.dispose()})),i=[])}function ie(e){if(!d||0===d.length)return;const t=l.find((t=>t.id===e));if(!t)return;const n=t.name,o=d.filter((e=>e.resort===n));if(0===o.length)return;document.querySelectorAll(`.content-section[id^="${e}"]`).forEach((e=>{const t=e.querySelector(".weather-container");t&&t.remove();const n=document.createElement("div");n.className="weather-container",o.forEach((e=>{if(!e||!e.data||0===e.data.length)return;const t=e.data[e.data.length-1],o=document.createElement("div");o.className="weather-info-wrapper";const a=document.createElement("div");a.className="weather-info";const i=X(e,e.timestamp,!0),s=Z(t);a.appendChild(i),a.appendChild(s),o.appendChild(a),n.appendChild(o)}));const a=e.querySelector(".videos-grid"),i=e.querySelector(".video-container");if(a)a.after(n);else if(i)i.after(n);else{const t=e.querySelector("h2");t?t.after(n):e.appendChild(n)}}))}function se(){const e=window.location.hash.substring(1);if(!e){R(!1),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const e=document.getElementById("default-message");return e.classList.add("active"),e.style.display="block",U(),void(document.title=a)}if(!window.processingHashChange){window.processingHashChange=!0;try{if("quad"===e)return _(!1),void(document.title=`${a} - 4분할 모드`);if(R(!1),"misc"===e){const e=document.getElementById("default-message");e.classList.remove("active"),e.style.display="none",document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active")));const t=document.querySelector('.menu-item[data-target="misc"]');t&&t.classList.add("active"),te(),ae(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const n=document.getElementById("misc");return n&&n.classList.add("active"),void(document.title=`${a} - 유용한 기능`)}if(e.startsWith("misc/")){const t=document.getElementById("default-message");t.classList.remove("active"),t.style.display="none",document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active")));const n=document.querySelector('.menu-item[data-target="misc"]');n&&n.classList.add("active");const o=document.getElementById("misc-submenu");if(o){o.classList.add("active");const e=n.querySelector(".dropdown-toggle");e&&(e.innerHTML='<i class="bi bi-chevron-up"></i>')}if("forecast"===e.split("/")[1]){document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")}));const e=document.querySelector('.submenu-item[data-target="misc-forecast"]');e&&e.classList.add("active"),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const t=document.getElementById("misc-forecast");t&&t.classList.add("active"),document.title=`${a} - 일기예보`,ee(),be(),ye()}return}const t=e.split("/"),n=t[0],o=t[1];oe(n,o);const s=document.getElementById("default-message");s.classList.remove("active"),s.style.display="none";const c=document.querySelector(`.menu-item[data-target="${n}"]`);if(c){document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active"))),c.classList.add("active"),te(),c.classList.add("active"),ae(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));if("true"===c.getAttribute("data-has-submenu")){const e=document.getElementById(`${n}-submenu`);if(e&&e.classList.add("active"),o){const e=parseInt(o);if(!isNaN(e)){const t=document.querySelector(`#${n}-submenu .submenu-item[data-webcam-index="${e}"]`);if(t){document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")})),t.classList.add("active");const o=document.getElementById(t.getAttribute("data-target"));if(o){o.classList.add("active");const t=o.querySelector(".video-container");if(t){const o=l.find((e=>e.id===n));if(o){const a=o.links||o.webcams||[];if(a[e]){const o=a[e].video||a[e].link;if(o){const s=re(o,t,`${n}-${e}`,a[e].video_type);s&&i.push(s),de(t,n,e,a[e].name,o,a[e].video_type),ie(n)}else t.innerHTML='<div class="error-message">No video stream available</div>'}else t.innerHTML='<div class="error-message">No video stream available</div>'}}}}}}else{document.querySelectorAll(".submenu-item").forEach((e=>e.classList.remove("active")));const e=document.getElementById(`${n}-main`);e&&(e.classList.add("active"),ce(n))}const t=c.querySelector(".dropdown-toggle");t&&(t.innerHTML='<i class="bi bi-chevron-up"></i>')}else{const e=document.getElementById(n);e&&e.classList.add("active")}d&&d.length>0?ie(n):fetch("weather.json?v="+(new Date).getTime()).then((e=>e.ok?e.json():(console.warn("Weather data not available"),null))).then((e=>{e&&(d=e,console.log("Weather data loaded:",d.length,"locations"),ie(n))})).catch((e=>{console.error("Error loading weather data:",e)}))}}finally{setTimeout((()=>{window.processingHashChange=!1,O(),Le()}),100)}}}function ce(e){const t=l.find((t=>t.id===e));if(!t)return;const n=t.links||t.webcams||[];if(0===n.length)return;const o=document.getElementById(`${e}-main`);if(!o)return;let a=o.querySelector(".videos-grid");if(!a){a=document.createElement("div"),a.className="videos-grid";const e=o.querySelector("h2");e?e.after(a):o.appendChild(a)}a.innerHTML="",n.forEach(((t,n)=>{const o=t.video||t.link;if(!o)return;const s=document.createElement("div");s.className="video-card";const c=document.createElement("h3");c.textContent=t.name,c.className="cursor-pointer",c.addEventListener("click",(function(){const t=document.querySelector(`#${e}-submenu .submenu-item[data-webcam-index="${n}"]`);t&&t.click()})),s.appendChild(c);const r=document.createElement("div");r.className="video-container",s.appendChild(r),a.appendChild(s);const l=re(o,r,`${e}-grid-${n}`,t.video_type);l&&i.push(l),de(r,e,n,t.name,o,t.video_type)})),O(),ie(e),setTimeout(Le,500)}function re(e,t,n,o,a=null){t.innerHTML="";const i=n.split("-"),s=i[0];let c=parseInt(i[1]);3===i.length&&"grid"===i[1]&&(c=parseInt(i[2]));let r="";if(s&&!isNaN(c)){const e=l.find((e=>e.id===s));if(e){const t=e.links||e.webcams||[];t[c]&&(r=t[c].name||"")}}if("vivaldi"===o){const n=document.createElement("div");n.className="iframe-container";const i=e.split(":");if(2===i.length){const d=i[0],u=i[1],m=null!==a?a:p.autoplay;n.innerHTML=`<iframe src="vivaldi.html?channel=${d}&serial=${u}&autoplay=${m}" allowfullscreen></iframe>`,t.appendChild(n),s&&!isNaN(c)&&de(t,s,c,r,e,o,le.VIVALDI);const f=document.createElement("button");return f.className="capture-button",f.innerHTML='\n          <i class="bi bi-camera"></i>\n          캡처\n          ',f.addEventListener("click",(()=>{const e=t.querySelector("iframe");if(e)try{const n=e.contentDocument.getElementById("player-container");if(n&&!n.classList.contains("playing"))return void ue(t,"영상이 재생 중일 때만 캡처할 수 있습니다.","warning")}catch(e){console.error("Cannot check vivaldi playing state",e)}!function(e){try{const t=e.querySelector("iframe");if(!t)return void alert("캡처할 영상을 찾을 수 없습니다.");const n=e.closest(".content-section");let o,a;if(n){const t=n.id.split("-");if(t.length>=3&&"webcam"===t[1]){const n=t[0],i=parseInt(t[2]),s=l.find((e=>e.id===n));if(s&&!isNaN(i)){(s.links||s.webcams||[])[i]&&(o=me(e),a=pe(e))}}}if(!o||!a){const t=window.location.hash.substring(1).split("/");if(t.length>1){const n=t[0],i=parseInt(t[1]),s=l.find((e=>e.id===n));if(s&&!isNaN(i)){(s.links||s.webcams||[])[i]&&(o=me(e),a=pe(e))}}}o||(o=me(e)),a||(a=pe(e));const i=`capture_${o}_${a}_${fe()}.jpg`,s=t.contentDocument.body;html2canvas(s,{useCORS:!1}).then((t=>{ve(t.toDataURL("image/jpeg"),i),ue(e,"캡처 완료!","success")}))}catch(t){console.error("Error capturing screenshot:",t),ue(e,"캡처 중 오류가 발생했습니다.","danger")}}(t)})),t.appendChild(f),{dispose:function(){t.innerHTML=""}}}return t.innerHTML='<div class="error-message">Invalid vivaldi video URL format. Expected: "channel:serial"</div>',null}if("iframe"===o){const n=document.createElement("div");return n.className="iframe-container",n.innerHTML=`<iframe src="${e}" allowfullscreen></iframe>`,t.appendChild(n),s&&!isNaN(c)&&de(t,s,c,r,e,o,le.LINK),{dispose:function(){t.innerHTML=""}}}if("youtube"===o){const n=document.createElement("div");n.className="iframe-container";const i=function(e){const t=/^(?:https?:\/\/)?(?:www\.)?youtube\.com\/live\/([^#&?]*).*/,n=e.match(t);if(n&&n[1]&&11===n[1].length)return n[1];const o=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,a=e.match(o);return a&&11===a[2].length?a[2]:null}(e);if(i){const l=(null!==a?a:p.autoplay)?"1":"0";return n.innerHTML=`<iframe src="https://www.youtube.com/embed/${i}?autoplay=${l}&mute=1" allowfullscreen></iframe>`,t.appendChild(n),s&&!isNaN(c)&&de(t,s,c,r,e,o,le.YOUTUBE),{dispose:function(){t.innerHTML=""}}}}if("link"===o){const n=document.createElement("div");n.className="d-flex justify-content-center align-items-center link-container";const a=document.createElement("a");return a.href=e,a.target="_blank",a.rel="noopener noreferrer",a.className="btn btn-primary btn-lg",a.innerHTML='\n        <i class="bi bi-box-arrow-up-right me-2"></i>\n        외부 링크\n      ',n.appendChild(a),t.appendChild(n),s&&!isNaN(c)&&de(t,s,c,r,e,o,le.LINK),{dispose:function(){t.innerHTML=""}}}const d=function(e){if(!e||!e.includes("-"))return null;const t=e.split("-");if(t.length<2)return null;let n=t[0],o=parseInt(t[1]);"quad"===t[0]&&t.length>=3?(n=t[1],o=parseInt(t[2])):3===t.length&&"grid"===t[1]&&(o=parseInt(t[2]));if(isNaN(o))return null;const a=l.find((e=>e.id===n));if(!a)return null;const i=a.links||a.webcams||[];return i[o]?{resort:a,webcam:i[o]}:null}(n);let u=null;d&&d.webcam&&d.webcam.link&&(u=d.webcam.link),t.innerHTML=`\n      <video\n        id="webcam-player-${n}"\n        class="video-js vjs-theme-forest vjs-big-play-centered"\n        controls\n        ${p.autoplay?"autoplay":""}\n        muted\n        playsinline\n        preload="auto"\n        crossorigin="anonymous"\n      >\n        <source src="${e}" type="application/x-mpegURL">\n        <p class="vjs-no-js">\n          최신 브라우저를 사용하세요.\n        </p>\n      </video>\n    `;try{const i=null!==a?a:p.autoplay,u=videojs(`webcam-player-${n}`,{autoplay:i,muted:!0,controls:!0,preload:"auto",fluid:!0,html5:{hls:{enableLowInitialPlaylist:!0,smoothQualityChange:!0,overrideNative:!0},nativeVideoTracks:!1,nativeAudioTracks:!1},controlBar:{captionsButton:!1,pictureInPictureToggle:!1},notSupportedMessage:"비디오 재생 중 오류가 발생했습니다."}),m=document.createElement("button");if(m.className="capture-button",m.innerHTML='\n        <i class="bi bi-camera"></i>\n        캡처\n      ',m.addEventListener("click",(()=>function(e){try{const t=document.createElement("canvas"),n=e.el().querySelector("video");if(n.readyState<2)return void ue(e.el(),"비디오가 로드되지 않았습니다.","warning");t.width=n.videoWidth,t.height=n.videoHeight;t.getContext("2d").drawImage(n,0,0,t.width,t.height);const o=e.el().id;let a,i;if(o){const n=o.replace("webcam-player-","").split("-");if(n.length>=2){"quad"===n[0]&&n.length>=3?(a=n[1],i=parseInt(n[2])):"grid"===n[1]?(a=n[0],i=parseInt(n[2])):(a=n[0],i=parseInt(n[1]));const o=l.find((e=>e.id===a));if(o&&!isNaN(i)){const n=o.links||o.webcams||[];if(n[i]){const a=he(o.name),s=he(n[i].name||`Camera ${i+1}`),c=`capture_${a}_${s}_${fe()}.jpg`;ve(t.toDataURL("image/jpeg"),c);return void ue(e.el().parentNode,"캡처 완료!","success")}}}}const s=me(e.el()),c=pe(e.el()),r=`capture_${s}_${c}_${fe()}.jpg`;ve(t.toDataURL("image/jpeg"),r);const d=e.el().parentNode;showSuccessMessage(d)}catch(e){console.error("Error capturing frame:",e),alert("캡처 중 오류가 발생했습니다.")}}(u))),t.appendChild(m),document.pictureInPictureEnabled||document.exitPictureInPicture&&document.requestPictureInPicture){const e=document.createElement("button");e.className="pip-button",e.innerHTML='\n          <i class="bi bi-pip"></i>\n          PIP\n        ',e.addEventListener("click",(()=>function(e){const t=e.el().querySelector("video");if(!t)return;document.pictureInPictureElement?document.exitPictureInPicture().catch((e=>{console.error("Error exiting Picture-in-Picture mode:",e)})):(document.pictureInPictureEnabled||t.requestPictureInPicture)&&t.requestPictureInPicture().catch((e=>{console.error("Error entering Picture-in-Picture mode:",e)}))}(u))),t.appendChild(e)}return s&&!isNaN(c)&&de(t,s,c,r,e,o,le.DEFAULT),u.on("error",(function(){const a=u.error();console.error("Video player error:",a);let i=null;if(d&&d.webcam)i=d.webcam.link||null;else{const e=l.find((e=>e.id===s));if(e){const t=e.links||e.webcams||[];t[c]&&t[c].link&&(i=t[c].link)}}let m='<div class="error-message"><p>비디오 재생 중 오류가 발생했습니다.</p>';m+='<div class="d-flex justify-content-center gap-2 mt-3 flex-wrap">',i&&(m+=`\n            <a href="${i}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">\n              <i class="bi bi-box-arrow-up-right me-2"></i>\n              원본 링크\n            </a>`),m+='\n          <button class="btn btn-secondary retry-button">\n            <i class="bi bi-arrow-clockwise me-2"></i>\n            재시도\n          </button>',m+="</div>",m+="</div>",t.innerHTML=m,s&&!isNaN(c)&&de(t,s,c,r,e,o,le.ERROR);const p=t.querySelector(".retry-button");p&&p.addEventListener("click",(function(a){a.preventDefault(),console.log("Retrying video load:",n),re(e,t,n,o)}))})),u}catch(n){return console.error("Error creating video player:",n),t.innerHTML='<div class="error-message">비디오 플레이어를 생성하는 중 오류가 발생했습니다.</div>',s&&!isNaN(c)&&de(t,s,c,r,e,o,le.ERROR),null}}const le={ERROR:1,LINK:2,YOUTUBE:3,VIVALDI:4,DEFAULT:0};function de(e,t,n,o,a,i,s=le.DEFAULT){if("string"==typeof t&&t.includes("favorite-player"))return;if(e.querySelector(".bookmark-button"))return;const c=document.createElement("button");c.className="bookmark-button",c.setAttribute("data-resort-id",t),c.setAttribute("data-webcam-index",n),c.innerHTML='\n      <span class="bookmark-icon"><i class="bi bi-bookmark"></i></span>\n      북마크\n    ',c.addEventListener("click",(function(){W(t,n,o,a,i)})),s===le.ERROR?c.classList.add("bookmark-button-error"):s===le.LINK?c.classList.add("bookmark-button-link"):s===le.YOUTUBE?c.classList.add("bookmark-button-youtube"):s===le.VIVALDI&&c.classList.add("bookmark-button-vivaldi"),e.appendChild(c)}function ue(e,t,n="success"){const o=document.createElement("div");o.className=`alert alert-${n} position-absolute top-0 start-50 translate-middle-x mt-3 toast-message`,o.textContent=t,e.appendChild(o),setTimeout((()=>{o.classList.add("fade-out"),setTimeout((()=>{o.remove()}),500)}),2e3)}function me(e){if(e){const t=e.closest(".favorite-card");if(t){const e=t.querySelector(".favorite-resort");if(e&&e.textContent)return he(e.textContent.trim())}}const t=document.querySelector(".content-section.active .resort-label");if(t&&t.textContent)return he(t.textContent.trim());const n=window.location.hash.substring(1);if(n){const e=n.split("/")[0],t=l.find((t=>t.id===e));if(t)return he(t.name)}const o=document.querySelector(".menu-item.active");if(o){return he(o.textContent.trim().split("\n")[0])}return"unknown"}function pe(e){const t=e.closest(".video-container"),n=t?.closest(".favorite-card");if(n){const e=n.querySelector(".favorite-location");if(e&&e.textContent)return he(e.textContent.trim())}const o=t.querySelector(".vjs-tech")||t.querySelector("iframe")||t.querySelector(".vivaldi-container");if(o&&o.id){const e=o.id.match(/player-([^-]+)-(\d+)/)||o.id.match(/player-([^-]+)-grid-(\d+)/);if(e&&e.length>=3){const t=e[1],n=parseInt(e[2]),o=l.find((e=>e.id===t));if(o){const e=o.links||o.webcams||[];if(e[n])return he(e[n].name)}}}const a=document.querySelector(".submenu-item.active");if(a&&!a.classList.contains("submenu-item-status"))return he(a.textContent.trim());const i=document.querySelector(".content-section.active .inline-title.inline-title-submenu");if(i&&i.textContent)return he(i.textContent.trim());const s=window.location.hash.substring(1);if(s){const e=s.split("/");if(e.length>1){const t=e[0],n=e[1];if(t&&n&&!isNaN(parseInt(n))){const e=l.find((e=>e.id===t));if(e){const t=e.links||e.webcams||[],o=parseInt(n);if(t[o])return he(t[o].name)}}}}const c=e.closest(".video-card");if(c){const e=c.querySelector("h3");if(e)return he(e.textContent.trim())}return"webcam"}function fe(){const e=new Date;return`${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}_${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`}function he(e){return e.replace(/[^가-힣\w\s,()-]/g,"").replace(/\s+/g,"_")}function ve(e,t){if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)&&navigator.canShare&&navigator.share)try{const n=e.split(","),o=n[0].match(/:(.*?);/)[1],a=atob(n[1]);let i=a.length;const s=new Uint8Array(i);for(;i--;)s[i]=a.charCodeAt(i);const c=new File([s],t,{type:o});if(navigator.canShare({files:[c]}))return void navigator.share({files:[c],title:t}).catch((n=>{"AbortError"!==n.name&&(console.error("Sharing failed:",n),ge(e,t))}))}catch(e){console.error("Error preparing share:",e)}ge(e,t)}function ge(e,t){const n=document.createElement("a");n.href=e,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function ye(){window.innerWidth<=768&&(t.classList.remove("active"),n.classList.remove("active"))}function be(){fetch("weather.grid.json?v="+(new Date).getTime()).then((e=>{if(!e.ok)throw new Error("Failed to load forecast data");return e.json()})).then((e=>{!function(e){const t=document.getElementById("forecast");if(!t)return;t.innerHTML="";const n=document.createElement("div");n.className="forecast-header";const o=new Date(e.last_fetch_time);n.innerHTML=`<h4>5일 예보 <small>(${o.toLocaleDateString("ko-KR")} ${o.toLocaleTimeString("ko-KR")} 업데이트)</small></h4>`,t.appendChild(n);const a={temperature:"rgb(255, 99, 132)",wind:"rgb(54, 162, 235)",snowfall:"rgb(153, 102, 255)"},i=new Date,s=[];for(let e=0;e<=120;e+=3){const t=new Date(i.getTime()+60*e*60*1e3);s.push(t)}const c=l.filter((e=>e.name)),r=document.createElement("div");r.className="chart-grid",t.appendChild(r);const d=e.weathers;console.log("Weather data structure:",{lastFetchTime:e.last_fetch_time,weathersCount:d.length,sampleData:d[0]||null}),c.forEach((e=>{const t=e.name,n=d.find((e=>e&&"object"==typeof e&&e.resort===t));if(!n)return void console.error(`No forecast data found for resort ${t}`);const o=document.createElement("div");o.className="chart-container";const s=document.createElement("div");s.className="chart-header";const c=document.createElement("h4");if(c.textContent=t,s.appendChild(c),!n.forecasts){console.error(`Invalid data format for resort ${t}:`,n);const e=document.createElement("div");return e.className="alert alert-warning",e.textContent=`${t}의 예보 데이터를 불러올 수 없습니다.`,o.appendChild(e),void r.appendChild(o)}const l=n.forecasts.filter((e=>e&&"object"==typeof e));if(l.length>0&&console.log(`Sample forecast for ${t}:`,l[0]),0===l.length){console.error(`No valid forecasts for resort ${t}`);const e=document.createElement("div");return e.className="alert alert-warning",e.textContent=`${t}의 예보 데이터가 비어있습니다.`,o.appendChild(e),void r.appendChild(o)}const u=Math.max(...l.map((e=>e.temp||-1/0))),m=Math.min(...l.map((e=>e.temp||1/0))),p=l.reduce(((e,t)=>e+(t.snow_3h||0)),0),f=document.createElement("div");f.className="forecast-summary",f.innerHTML=`\n        <span class="temp-range">기온: ${m.toFixed(1)}°C ~ ${u.toFixed(1)}°C</span>\n        <span class="total-snow">총 강설량: ${p.toFixed(1)}cm</span>\n      `,s.appendChild(f),o.appendChild(s);const h=document.createElement("canvas");h.id=`chart-${e.id}`,o.appendChild(h),r.appendChild(o);const v=[],g=[],y=[],b=[];l.sort(((e,t)=>new Date(e.timestamp)-new Date(t.timestamp))),l.forEach((e=>{if(e&&e.timestamp){const t=new Date(e.timestamp);t>i&&t<new Date(i.getTime()+432e6)&&(b.push(t),v.push(e.temp),g.push(e.wind_speed),y.push(e.snow_3h||0))}})),Chart.defaults.color="#e0e0e0",Chart.defaults.borderColor="rgba(255, 255, 255, 0.1)",new Chart(h,{type:"line",data:{labels:b,datasets:[{label:"기온 (°C)",data:v,borderColor:a.temperature,backgroundColor:a.temperature+"33",borderWidth:2,yAxisID:"y",tension:.3,pointRadius:3,pointHoverRadius:5,fill:!1,spanGaps:!0},{label:"풍속 (m/s)",data:g,borderColor:a.wind,backgroundColor:a.wind+"33",borderWidth:2,yAxisID:"y1",tension:.3,pointRadius:3,pointHoverRadius:5,fill:!1,spanGaps:!0},{label:"강설량 (cm/3h)",data:y,borderColor:a.snowfall,backgroundColor:a.snowfall+"33",borderWidth:2,yAxisID:"y2",tension:.3,pointRadius:3,pointHoverRadius:5,fill:!1,spanGaps:!0}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{tooltip:{callbacks:{title:function(e){const t=new Date(e[0].parsed.x);return t.toLocaleDateString("ko-KR")+" "+t.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})}},backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1},legend:{position:"top",labels:{usePointStyle:!0,padding:15,color:"#e0e0e0",font:{weight:"bold"}}}},scales:{x:{type:"time",time:{unit:"day",displayFormats:{day:"M/d"},tooltipFormat:"yyyy년 MM월 dd일 HH:mm"},title:{display:!0,text:"날짜/시간",color:"#e0e0e0",font:{weight:"bold"}},ticks:{maxRotation:0,color:"#e0e0e0"},grid:{color:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)"}},y:{type:"linear",display:!0,position:"left",title:{display:!0,text:"기온 (°C)",color:a.temperature,font:{weight:"bold"}},suggestedMin:m-5,suggestedMax:u+5,ticks:{color:"#e0e0e0"},grid:{color:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)"}},y1:{type:"linear",display:!0,position:"right",title:{display:!0,text:"풍속 (m/s)",color:a.wind,font:{weight:"bold"}},grid:{drawOnChartArea:!1,color:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)"},ticks:{color:"#e0e0e0"}},y2:{type:"linear",display:!0,position:"right",title:{display:!0,text:"강설량 (cm/3h)",color:a.snowfall,font:{weight:"bold"}},grid:{drawOnChartArea:!1,color:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)"},suggestedMin:0,suggestedMax:1.5*Math.max(...y)||10,ticks:{color:"#e0e0e0"}}}}})})),0===r.children.length&&(t.innerHTML='<div class="alert alert-info">예보 데이터가 없습니다.</div>')}(e)})).catch((e=>{console.error("Error loading forecast data:",e);const t=document.getElementById("forecast");t&&(t.innerHTML='<div class="alert alert-danger">일기예보 데이터를 불러오지 못했습니다.</div>')}))}let we;function Ee(){we&&cancelAnimationFrame(we),we=requestAnimationFrame(Le)}function Le(){if(!p.autoplay||document.hidden)return;i=i.filter((e=>{const t=e.el();return t&&document.body.contains(t)}));const e=i.map((e=>{const t=e.el().getBoundingClientRect(),n=Math.min(t.bottom,window.innerHeight)-Math.max(t.top,0);return{player:e,rect:t,visible:(t.height>0?Math.max(0,n)/t.height:0)>.3,top:t.top}})).filter((e=>e.visible));e.sort(((e,t)=>e.top-t.top));const t=e.slice(0,4).map((e=>e.player));i.forEach((e=>{if(t.includes(e)){if(e.paused()){const t=e.play();void 0!==t&&t.catch((e=>{}))}}else e.paused()||e.pause()}))}e.addEventListener("click",(function(){t.classList.toggle("active"),n.classList.toggle("active")})),n.addEventListener("click",ye),window.addEventListener("resize",(function(){u=window.innerWidth<=768,window.innerWidth>768&&(t.classList.remove("active"),n.classList.remove("active"))})),window.addEventListener("hashchange",se),window.addEventListener("scroll",Ee,{passive:!0}),window.addEventListener("resize",Ee,{passive:!0}),document.addEventListener("visibilitychange",(function(){document.hidden?i.forEach((e=>{e.paused()||e.pause()})):Le()})),console.log("Calling initializeApp at end of DOMContentLoaded"),function(){console.log("initializeApp function entered");let e=Promise.resolve(null);window.location.hash&&(e=fetch("weather.json?v="+(new Date).getTime()).then((e=>e.ok?e.json():(console.warn("Weather data not available"),null))).then((e=>e?(d=e,e):null)).catch((e=>(console.error("Error loading weather data:",e),null)))),fetch("links.json?v="+(new Date).getTime()).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((n=>{if(Array.isArray(n)&&n.length>0)return function(e){console.log("initializeResorts called with",e.length,"resorts"),l=e,D(),t.innerHTML='<div class="site-title"><a href="./">Slopes cam</a></div>',document.getElementById("default-message"),Array.from(document.querySelectorAll(".content-section:not(#default-message)")).forEach((e=>e.remove()));const n=document.createElement("div");n.className="menu-item-container";const s=document.createElement("div");s.className="menu-item",s.setAttribute("data-target","misc"),s.setAttribute("data-has-submenu","true"),s.textContent="유용한 기능",n.appendChild(s);const d=document.createElement("span");d.className="dropdown-toggle",d.innerHTML='<i class="bi bi-chevron-down"></i>',d.setAttribute("aria-label","Toggle submenu"),s.appendChild(d),d.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();const t=n.querySelector(".submenu");if(t){const e=t.classList.contains("active");te(),e||(t.classList.add("active"),s.classList.add("active"),this.innerHTML='<i class="bi bi-chevron-up"></i>')}}));const u=document.createElement("div");u.className="submenu",u.id="misc-submenu",n.appendChild(u);const m=document.createElement("div");m.className="submenu-item",m.setAttribute("data-target","misc-forecast"),m.textContent="일기예보",u.appendChild(m);const p=document.createElement("div");p.className="content-section",p.id="misc-forecast";const f=document.createElement("h2");f.textContent="일기예보",f.className="inline-title",p.appendChild(f);const h=document.createElement("div");h.className="misc-content",h.innerHTML='\n      <div class="forecast-container">\n        <div id="forecast"></div>\n      </div>\n    ',p.appendChild(h),o.appendChild(p),m.addEventListener("click",(function(){document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")})),this.classList.add("active"),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const e=document.getElementById("default-message");e.classList.remove("active"),e.style.display="none",p.classList.add("active"),window.location.hash="misc/forecast",document.title=`${a} - 일기예보`,ee(),be(),ye()}));const v=document.createElement("div");v.className="content-section",v.id="misc";const g=document.createElement("h2");g.textContent="유용한 기능",g.className="inline-title",v.appendChild(g);const y=document.createElement("div");y.className="misc-content",y.innerHTML="\n      <p>메뉴에서 기능을 선택하세요.</p>\n    ",v.appendChild(y),o.appendChild(v),s.addEventListener("click",(function(e){if(e.target.classList.contains("dropdown-toggle")||e.target.closest(".dropdown-toggle"))return;document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".submenu-item").forEach((e=>e.classList.remove("active"))),this.classList.add("active"),te(),ae(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const t=document.getElementById("default-message");t.classList.remove("active"),t.style.display="none";const n=document.getElementById("misc-submenu");if(n){n.classList.add("active"),this.classList.add("active");const e=this.querySelector(".dropdown-toggle");e&&(e.innerHTML='<i class="bi bi-chevron-up"></i>')}const o=document.getElementById("misc");o&&o.classList.add("active"),window.location.hash="misc",document.title=`${a} - 유용한 기능`,ye()})),e.forEach((e=>{const n=e.id,a=e.name,s=e.links||e.webcams||[],l=s.length>0;if(0===s.length)return;const d=document.createElement("div");d.className="menu-item-container";const u=document.createElement("div");if(u.className="menu-item",u.setAttribute("data-target",n),l&&(u.setAttribute("data-has-submenu","true"),u.setAttribute("data-resort-id",n)),u.textContent=a,d.appendChild(u),l){const e=document.createElement("span");e.className="dropdown-toggle",e.innerHTML='<i class="bi bi-chevron-down"></i>',e.setAttribute("aria-label","Toggle submenu"),u.appendChild(e),e.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();const t=d.querySelector(".submenu");if(t){const e=t.classList.contains("active");te(),e||(t.classList.add("active"),u.classList.add("active"),this.innerHTML='<i class="bi bi-chevron-up"></i>')}}))}t.appendChild(d);const m=document.createElement("div");m.className="content-section",m.id=l?`${n}-main`:n;const p=document.createElement("h2");if(p.textContent=a,p.className="inline-title",m.appendChild(p),o.appendChild(m),l){const t=document.createElement("div");if(t.className="submenu",t.id=`${n}-submenu`,d.appendChild(t),e.status){const n=document.createElement("div");n.className="submenu-item submenu-item-status",n.innerHTML='오픈현황 <i class="bi bi-box-arrow-up-right me-1"></i>',t.appendChild(n),n.addEventListener("click",(function(){window.open(e.status,"_blank","noopener,noreferrer")}))}s.forEach(((e,c)=>{const l=e.name;if(!l)return;const d=document.createElement("div");d.className="submenu-item",d.setAttribute("data-target",`${n}-webcam-${c}`),d.setAttribute("data-webcam-index",c),d.textContent=l,t.appendChild(d);const u=document.createElement("div");u.className="content-section",u.id=`${n}-webcam-${c}`;const m=document.createElement("h2");m.textContent=l,m.className="inline-title inline-title-submenu cursor-pointer",m.addEventListener("click",(function(){const e=document.querySelector(`#${n}-submenu .submenu-item[data-webcam-index="${c}"]`);e&&e.click()})),u.appendChild(m);const p=document.createElement("span");p.textContent=a,p.className="resort-label",u.appendChild(p);const f=document.createElement("div");f.className="video-container",u.appendChild(f),o.appendChild(u),d.addEventListener("click",(function(){const e=this.getAttribute("data-webcam-index");r=e,ne(n,e),oe(n,e),document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")})),this.classList.add("active"),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const t=document.getElementById("default-message");t.classList.remove("active"),t.style.display="none";const o=document.getElementById(this.getAttribute("data-target"));if(o){o.classList.add("active"),ae();const t=o.querySelector(".video-container");if(t&&s[e]){const o=s[e].video||s[e].link;if(o){const a=re(o,t,`${n}-${e}`,s[e].video_type);a&&i.push(a),ie(n)}else t.innerHTML='<div class="error-message">No video stream available</div>'}}ye()}))}))}u.addEventListener("click",(function(e){if(e.target.classList.contains("dropdown-toggle")||e.target.closest(".dropdown-toggle"))return;const t=this.getAttribute("data-target"),n="true"===this.getAttribute("data-has-submenu"),o=this.getAttribute("data-resort-id");if(o&&(c=o,r=null),ne(t),oe(t,null),document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".submenu-item").forEach((e=>e.classList.remove("active"))),this.classList.add("active"),te(),n){const e=document.getElementById(`${t}-submenu`);if(e){e.classList.add("active"),this.classList.add("active");const t=this.querySelector(".dropdown-toggle");t&&(t.innerHTML='<i class="bi bi-chevron-up"></i>')}}ae(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const a=document.getElementById("default-message");if(a.classList.remove("active"),a.style.display="none",n){const e=document.getElementById(`${t}-main`);e&&(e.classList.add("active"),ce(t))}else{const e=document.getElementById(t);e&&e.classList.add("active")}ie(t),ye()}))})),!window.location.hash&&l.length>0||window.location.hash&&se()}(n),e.then((e=>e||fetch("weather.json?v="+(new Date).getTime()).then((e=>e.ok?e.json():(console.warn("Weather data not available"),null)))));throw new Error("Invalid data format")})).then((e=>{if(e){if(d=e,console.log("Weather data loaded:",d.length,"locations"),window.location.hash){const e=window.location.hash.substring(1).split("/")[0];e&&ie(e)}ee()}window.location.hash?se():U()})).catch((e=>{console.error("Error initializing app:",e);const t=document.getElementById("default-message");t?(t.innerHTML='<div class="error-message p-5 text-center"><h3>리조트 정보를 불러오지 못했습니다.</h3><p>페이지를 새로고침하세요.</p></div>',t.classList.add("active")):o.innerHTML='<div class="error-message">리조트 정보를 불러오지 못했습니다.</div>'}))}()}));