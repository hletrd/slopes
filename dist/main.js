"serviceWorker"in navigator&&window.addEventListener("load",(function(){"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?navigator.serviceWorker.getRegistrations().then((function(e){for(let t of e)t.unregister()})):navigator.serviceWorker.register("./service-worker.js").then((function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)})).catch((function(e){console.log("ServiceWorker registration failed: ",e)}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".toggle-menu"),t=document.querySelector(".sidebar"),n=document.querySelector(".sidebar-backdrop"),i=document.querySelector(".main-content"),a="Slopes cam";let o=[],s=null,c=null,r=[],l=[],d=window.innerWidth<=768,m=function(){try{const e=localStorage.getItem("webcamFavorites");return e?JSON.parse(e):[]}catch(e){return console.error("Error loading favorites:",e),[]}}(),u=function(){try{const e=localStorage.getItem("webcamSettings");if(e)return JSON.parse(e)}catch(e){console.error("Error loading settings:",e)}return{autoplay:!d}}();const p=document.getElementById("settingsButton"),h=document.getElementById("settingsModal"),f=document.getElementById("closeSettingsModal"),v=document.getElementById("autoplayToggle");v.checked=u.autoplay,v.addEventListener("change",(function(){u.autoplay=this.checked,function(){try{localStorage.setItem("webcamSettings",JSON.stringify(u))}catch(e){console.error("Error saving settings:",e)}}()})),p.addEventListener("click",(function(){h.style.display="block"})),f.addEventListener("click",(function(){h.style.display="none"})),window.addEventListener("click",(function(e){e.target===h&&(h.style.display="none")}));const g=document.getElementById("infoButton"),b=document.getElementById("infoModal"),y=document.getElementById("closeInfoModal");g.addEventListener("click",(function(){b.style.display="flex"})),y.addEventListener("click",(function(){b.style.display="none"})),window.addEventListener("click",(function(e){e.target===b&&(b.style.display="none")}));const w=document.getElementById("addToHomeButton"),E=document.getElementById("installationModal"),L=document.getElementById("closeModal");function C(){try{localStorage.setItem("webcamFavorites",JSON.stringify(m))}catch(e){console.error("Error saving favorites:",e)}}function N(e,t,n,i,a){const o=m.findIndex((n=>n.resortId===e&&n.webcamIndex===t));-1===o?m.push({resortId:e,webcamIndex:t,webcamName:n,resortName:r.find((t=>t.id===e))?.name||"",videoUrl:i,videoType:a}):m.splice(o,1),C(),k(),S()}function k(){document.querySelectorAll(".bookmark-button").forEach((e=>{!function(e,t){return m.some((n=>n.resortId===e&&n.webcamIndex===t))}(e.getAttribute("data-resort-id"),parseInt(e.getAttribute("data-webcam-index")))?(e.classList.remove("active"),e.querySelector(".bookmark-icon").innerHTML='<i class="bi bi-bookmark"></i>'):(e.classList.add("active"),e.querySelector(".bookmark-icon").innerHTML='<i class="bi bi-bookmark-fill"></i>')}))}function S(){const e=document.getElementById("favorites-container"),t=document.getElementById("favorites-grid");if(e&&t){if(0===m.length){const t=document.createElement("div");t.className="instruction",t.innerHTML="<p>북마크한 영상이 없습니다. 영상 오른쪽 위의 북마크 버튼을 눌러 영상을 추가해 보세요.<br>북마크는 같은 브라우저에서만 저장됩니다.</p>",e.appendChild(t)}if(e.style.display="block",t.innerHTML="",""===window.location.hash){const t=e.closest(".content-section");t&&(t.style.display="block")}else{const t=e.closest(".content-section");t&&(t.style.display="none")}o&&o.length>0&&(o=o.filter((e=>{const t=e.el_?.id;return!t||!t.includes("favorite-player")||(e.dispose(),!1)}))),m.forEach(((e,n)=>{const i=document.createElement("div");i.className="video-card favorite-card",i.draggable=!0,i.setAttribute("data-index",n);const a=document.createElement("div");a.className="drag-handle",a.innerHTML='<i class="bi bi-grip-vertical"></i>',i.appendChild(a);const s=document.createElement("div");s.className="favorites-header-container";const c=document.createElement("div");c.className="favorite-header";const r=document.createElement("span");r.className="favorite-location cursor-pointer",r.textContent=e.webcamName,r.addEventListener("click",(function(){const t=`${e.resortId}/${e.webcamIndex}`;window.location.hash=t}));const l=document.createElement("span");l.className="favorite-resort",l.textContent=e.resortName,c.appendChild(r),c.appendChild(l),s.appendChild(c);const d=document.createElement("button");d.className="favorites-remove-button",d.innerHTML='<i class="bi bi-trash"></i>',d.setAttribute("title","북마크 제거"),d.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),N(e.resortId,e.webcamIndex)})),s.appendChild(d),i.appendChild(s);const m=document.createElement("div");if(m.className="video-container",i.appendChild(m),t.appendChild(i),e.videoUrl){const t=`favorite-player-${n}`,i=K(e.videoUrl,m,t,e.videoType);i&&o.push(i)}i.addEventListener("dragstart",T),i.addEventListener("dragover",$),i.addEventListener("dragenter",q),i.addEventListener("dragleave",M),i.addEventListener("drop",A),i.addEventListener("dragend",H)})),_()}else console.error("Favorites container or grid not found")}w.addEventListener("click",(function(){E.style.display="block",setTimeout((function(){E.classList.add("active")}),10)})),L.addEventListener("click",(function(){E.classList.remove("active"),setTimeout((function(){E.style.display="none"}),400)})),E.addEventListener("click",(function(e){e.target===E&&L.click()}));let I=null,x=-1;function T(e){I=this,x=parseInt(this.getAttribute("data-index")),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.innerHTML),this.classList.add("dragging"),document.querySelectorAll(".favorite-card").forEach((e=>{e!==this&&e.classList.add("drop-target")}))}function $(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function q(e){this.classList.add("drag-over")}function M(e){this.classList.remove("drag-over")}function A(e){if(e.stopPropagation(),e.preventDefault(),this.classList.remove("drag-over"),I===this)return!1;const t=parseInt(this.getAttribute("data-index"));if(-1!==x&&-1!==t){const e=m[x];m.splice(x,1),m.splice(t,0,e),C(),S()}return!1}function H(e){document.querySelectorAll(".favorite-card").forEach((e=>{e.classList.remove("dragging","drag-over","drop-target")}))}function B(e,t,n=!1){const i=document.createElement("div");if(i.className="location-name",e.name.startsWith("리조트_")?i.textContent=e.name.replace("리조트_",""):i.textContent=e.name,t){const a=new Date(t);month=a.getMonth()+1,day=a.getDate(),hours=a.getHours().toString().padStart(2,"0"),minutes=a.getMinutes().toString().padStart(2,"0");const o=document.createElement("span");o.className="weather-update-time",o.textContent=`${month}월 ${day}일 ${hours}:${minutes} 기준`,n&&(e.name.startsWith("리조트_")?o.textContent+=" (리조트 제공)":o.textContent+=" (기상청 제공)"),i.appendChild(o)}return i}function D(e){const t=document.createElement("div");t.className="weather-data";class n{constructor(e,t,n,i,a=1){this.span=document.createElement("span"),this.span.className=e;const o=document.createElement("i");o.className=t,this.span.appendChild(o);const s=Number(n).toFixed(a);return this.span.appendChild(document.createTextNode(`${s}${i}`)),this.span}}if(null!==e.temperature){const i=new n("temperature","bi bi-thermometer-half",e.temperature,"°C");t.appendChild(i)}if(null!==e.humidity){t.appendChild(document.createTextNode(" • "));const i=new n("humidity","bi bi-moisture",e.humidity,"%",0);t.appendChild(i)}if(null!==e.wind_speed){t.appendChild(document.createTextNode(" • "));const i=new n("wind-speed","bi bi-wind",e.wind_speed,"m/s");t.appendChild(i)}if(null!==e.rainfall){t.appendChild(document.createTextNode(" • "));const i=new n("rainfall","bi bi-droplet-fill",e.rainfall,"mm");t.appendChild(i)}if(null!==e.snowfall_3hr){t.appendChild(document.createTextNode(" • "));const i=new n("snowfall","bi bi-snow",e.snowfall_3hr,"cm");t.appendChild(i)}return t}function _(){if(!l||0===l.length)return;if(!r||0===r.length)return;const e=document.getElementById("default-message");if(!e)return;const t=e.querySelector(".all-resorts-weather");t&&t.remove();const n=document.createElement("div");n.className="all-resorts-weather",n.innerHTML='<h3>전국 스키장 날씨 <span style="font-size: 0.6em; font-weight: normal; color: #999; margin-left: 6px;">기상청 데이터 기준</span></h3>';const i=document.createElement("div");if(i.className="weather-container",n.appendChild(i),r.forEach((e=>{const t=e.name,n=l.find((e=>e.resort===t&&"스키하우스"===e.name));if(n&&n.data&&n.data.length>0){const t=document.createElement("div");t.className="weather-info-wrapper";const a=document.createElement("div");a.className="weather-info";const o=n.data[n.data.length-1],s=B(e,n.timestamp,!1),c=D(o);a.appendChild(s),a.appendChild(c),t.appendChild(a),i.appendChild(t)}})),i.children.length>0){const t=e.querySelector("#favorites-container");t?t.after(n):e.appendChild(n)}const a=document.createElement("h3");a.style.marginTop="16px",a.textContent="전국 스키장 날씨";const o=document.createElement("span");o.textContent="리조트 데이터 기준",o.style.fontSize="0.6em",o.style.fontWeight="normal",o.style.color="#999",o.style.marginLeft="6px",a.appendChild(o),n.appendChild(a);const s=document.createElement("div");if(s.className="weather-container",n.appendChild(s),r.forEach((e=>{const t=e.name;l.filter((e=>e.resort===t&&e.name.startsWith("리조트_"))).forEach((t=>{if(t&&t.data&&t.data.length>0){const n=document.createElement("div");n.className="weather-info-wrapper";const i=document.createElement("div");i.className="weather-info";const a=t.data[t.data.length-1],o=B(e,t.timestamp,!1),c=D(a);i.appendChild(o),i.appendChild(c),n.appendChild(i),s.appendChild(n)}}))})),s.children.length>0){const t=e.querySelector("#favorites-container");t?t.after(n):e.appendChild(n)}}function R(){document.querySelectorAll(".submenu").forEach((e=>{e.classList.remove("active")})),document.querySelectorAll('.menu-item[data-has-submenu="true"]').forEach((e=>{e.classList.remove("active")})),document.querySelectorAll(".dropdown-toggle").forEach((e=>{e.innerHTML='<i class="bi bi-chevron-down"></i>'}))}function j(e,t){const n=t?`${e}/${t}`:e;if(window.location.hash.substring(1)===n)return;const i=new URL(window.location);i.hash=n,history.pushState(null,"",i),P(e,t)}function P(e,t){if(!e)return void(document.title=a);const n=r.find((t=>t.id===e));if(n)if(null!=t){const e=parseInt(t),i=n.links||n.webcams||[];if(!isNaN(e)&&i[e]){const t=i[e].name;document.title=`${a} - ${t} - ${n.name}`}else document.title=`${a} - ${n.name}`}else document.title=`${a} - ${n.name}`;else document.title=a}function W(){o&&o.length>0&&(o.forEach((e=>{e&&"function"==typeof e.dispose&&e.dispose()})),o=[])}function U(e){if(!l||0===l.length)return;const t=r.find((t=>t.id===e));if(!t)return;const n=t.name,i=l.filter((e=>e.resort===n));if(0===i.length)return;document.querySelectorAll(`.content-section[id^="${e}"]`).forEach((e=>{const t=e.querySelector(".weather-container");t&&t.remove();const n=document.createElement("div");n.className="weather-container",i.forEach((e=>{if(!e||!e.data||0===e.data.length)return;const t=e.data[e.data.length-1],i=document.createElement("div");i.className="weather-info-wrapper";const a=document.createElement("div");a.className="weather-info";const o=B(e,e.timestamp,!0),s=D(t);a.appendChild(o),a.appendChild(s),i.appendChild(a),n.appendChild(i)}));const a=e.querySelector(".videos-grid"),o=e.querySelector(".video-container");if(a)a.after(n);else if(o)o.after(n);else{const t=e.querySelector("h2");t?t.after(n):e.appendChild(n)}}))}function O(){const e=window.location.hash.substring(1);if(!e){document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const e=document.getElementById("default-message");return e.classList.add("active"),e.style.display="block",S(),void(document.title=a)}if(!window.processingHashChange){window.processingHashChange=!0;try{if("misc"===e){const e=document.getElementById("default-message");e.classList.remove("active"),e.style.display="none",document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active")));const t=document.querySelector('.menu-item[data-target="misc"]');t&&t.classList.add("active"),R(),W(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const n=document.getElementById("misc");return n&&n.classList.add("active"),void(document.title=`${a} - 유용한 기능`)}if(e.startsWith("misc/")){const t=document.getElementById("default-message");t.classList.remove("active"),t.style.display="none",document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active")));const n=document.querySelector('.menu-item[data-target="misc"]');n&&n.classList.add("active");const i=document.getElementById("misc-submenu");if(i){i.classList.add("active");const e=n.querySelector(".dropdown-toggle");e&&(e.innerHTML='<i class="bi bi-chevron-up"></i>')}if("forecast"===e.split("/")[1]){document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")}));const e=document.querySelector('.submenu-item[data-target="misc-forecast"]');e&&e.classList.add("active"),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const t=document.getElementById("misc-forecast");t&&t.classList.add("active"),document.title=`${a} - 일기예보`,_(),te(),ee()}return}const t=e.split("/"),n=t[0],i=t[1];P(n,i);const s=document.getElementById("default-message");s.classList.remove("active"),s.style.display="none";const c=document.querySelector(`.menu-item[data-target="${n}"]`);if(c){document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active"))),c.classList.add("active"),R(),c.classList.add("active"),W(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));if("true"===c.getAttribute("data-has-submenu")){const e=document.getElementById(`${n}-submenu`);if(e&&e.classList.add("active"),i){const e=parseInt(i);if(!isNaN(e)){const t=document.querySelector(`#${n}-submenu .submenu-item[data-webcam-index="${e}"]`);if(t){document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")})),t.classList.add("active");const i=document.getElementById(t.getAttribute("data-target"));if(i){i.classList.add("active");const t=i.querySelector(".video-container");if(t){const i=r.find((e=>e.id===n));if(i){const a=i.links||i.webcams||[];if(a[e]){const i=a[e].video||a[e].link;if(i){const s=K(i,t,`${n}-${e}`,a[e].video_type);s&&o.push(s),z(t,n,e,a[e].name,i,a[e].video_type),U(n)}else t.innerHTML='<div class="error-message">No video stream available</div>'}else t.innerHTML='<div class="error-message">No video stream available</div>'}}}}}}else{document.querySelectorAll(".submenu-item").forEach((e=>e.classList.remove("active")));const e=document.getElementById(`${n}-main`);e&&(e.classList.add("active"),F(n))}const t=c.querySelector(".dropdown-toggle");t&&(t.innerHTML='<i class="bi bi-chevron-up"></i>')}else{const e=document.getElementById(n);e&&e.classList.add("active")}l&&l.length>0?U(n):fetch("weather.json?v="+(new Date).getTime()).then((e=>e.ok?e.json():(console.warn("Weather data not available"),null))).then((e=>{e&&(l=e,console.log("Weather data loaded:",l.length,"locations"),U(n))})).catch((e=>{console.error("Error loading weather data:",e)}))}}finally{setTimeout((()=>{window.processingHashChange=!1,k()}),100)}}}function F(e){const t=r.find((t=>t.id===e));if(!t)return;const n=t.links||t.webcams||[];if(0===n.length)return;const i=document.getElementById(`${e}-main`);if(!i)return;let a=i.querySelector(".videos-grid");if(!a){a=document.createElement("div"),a.className="videos-grid";const e=i.querySelector("h2");e?e.after(a):i.appendChild(a)}a.innerHTML="",n.forEach(((t,n)=>{const i=t.video||t.link;if(!i)return;const s=document.createElement("div");s.className="video-card";const c=document.createElement("h3");c.textContent=t.name,c.className="cursor-pointer",c.addEventListener("click",(function(){const t=document.querySelector(`#${e}-submenu .submenu-item[data-webcam-index="${n}"]`);t&&t.click()})),s.appendChild(c);const r=document.createElement("div");r.className="video-container",s.appendChild(r),a.appendChild(s);const l=K(i,r,`${e}-grid-${n}`,t.video_type);l&&o.push(l),z(r,e,n,t.name,i,t.video_type)})),k(),U(e)}function K(e,t,n,i){t.innerHTML="";const a=n.split("-"),o=a[0];let s=parseInt(a[1]);3===a.length&&"grid"===a[1]&&(s=parseInt(a[2]));let c="";if(o&&!isNaN(s)){const e=r.find((e=>e.id===o));if(e){const t=e.links||e.webcams||[];t[s]&&(c=t[s].name||"")}}if("vivaldi"===i){const n=document.createElement("div");n.className="iframe-container";const a=e.split(":");if(2===a.length){const l=a[0],d=a[1];n.innerHTML=`<iframe src="vivaldi.html?channel=${l}&serial=${d}&autoplay=${u.autoplay}" allowfullscreen></iframe>`,t.appendChild(n),o&&!isNaN(s)&&z(t,o,s,c,e,i,V.VIVALDI);const m=document.createElement("button");return m.className="capture-button",m.innerHTML='\n          <i class="bi bi-camera"></i>\n          캡처\n          ',m.addEventListener("click",(()=>function(e){try{const t=e.querySelector("iframe");if(!t)return void alert("캡처할 영상을 찾을 수 없습니다.");const n=e.closest(".content-section");let i,a;if(n){const t=n.id.split("-");if(t.length>=3&&"webcam"===t[1]){const n=t[0],o=parseInt(t[2]),s=r.find((e=>e.id===n));if(s&&!isNaN(o)){(s.links||s.webcams||[])[o]&&(i=Y(e),a=G(e))}}}if(!i||!a){const t=window.location.hash.substring(1).split("/");if(t.length>1){const n=t[0],o=parseInt(t[1]),s=r.find((e=>e.id===n));if(s&&!isNaN(o)){(s.links||s.webcams||[])[o]&&(i=Y(e),a=G(e))}}}i||(i=Y(e)),a||(a=G(e));const o=`capture_${i}_${a}_${Q()}.jpg`,s=t.contentDocument.body;html2canvas(s,{useCORS:!1}).then((t=>{Z(t.toDataURL("image/jpeg"),o),J(e)}))}catch(e){console.error("Error capturing screenshot:",e),alert("캡처 중 오류가 발생했습니다.")}}(t))),t.appendChild(m),{dispose:function(){t.innerHTML=""}}}return t.innerHTML='<div class="error-message">Invalid vivaldi video URL format. Expected: "channel:serial"</div>',null}if("iframe"===i){const n=document.createElement("div");return n.className="iframe-container",n.innerHTML=`<iframe src="${e}" allowfullscreen></iframe>`,t.appendChild(n),o&&!isNaN(s)&&z(t,o,s,c,e,i,V.LINK),{dispose:function(){t.innerHTML=""}}}if("youtube"===i){const n=document.createElement("div");n.className="iframe-container";const a=function(e){const t=/^(?:https?:\/\/)?(?:www\.)?youtube\.com\/live\/([^#&?]*).*/,n=e.match(t);if(n&&n[1]&&11===n[1].length)return n[1];const i=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,a=e.match(i);return a&&11===a[2].length?a[2]:null}(e);if(a){const r=u.autoplay?"1":"0";return n.innerHTML=`<iframe src="https://www.youtube.com/embed/${a}?autoplay=${r}&mute=1" allowfullscreen></iframe>`,t.appendChild(n),o&&!isNaN(s)&&z(t,o,s,c,e,i,V.YOUTUBE),{dispose:function(){t.innerHTML=""}}}}if("link"===i){const n=document.createElement("div");n.className="d-flex justify-content-center align-items-center link-container";const a=document.createElement("a");return a.href=e,a.target="_blank",a.rel="noopener noreferrer",a.className="btn btn-primary btn-lg",a.innerHTML='\n        <i class="bi bi-box-arrow-up-right me-2"></i>\n        외부 링크\n      ',n.appendChild(a),t.appendChild(n),o&&!isNaN(s)&&z(t,o,s,c,e,i,V.LINK),{dispose:function(){t.innerHTML=""}}}const l=function(e){if(!e||!e.includes("-"))return null;const t=e.split("-");if(t.length<2)return null;const n=t[0];let i=parseInt(t[1]);3===t.length&&"grid"===t[1]&&(i=parseInt(t[2]));if(isNaN(i))return null;const a=r.find((e=>e.id===n));if(!a)return null;const o=a.links||a.webcams||[];return o[i]?{resort:a,webcam:o[i]}:null}(n);let d=null;l&&l.webcam&&l.webcam.link&&(d=l.webcam.link),t.innerHTML=`\n      <video\n        id="webcam-player-${n}"\n        class="video-js vjs-theme-forest vjs-big-play-centered"\n        controls\n        ${u.autoplay?"autoplay":""}\n        muted\n        playsinline\n        preload="auto"\n      >\n        <source src="${e}" type="application/x-mpegURL">\n        <p class="vjs-no-js">\n          최신 브라우저를 사용하세요.\n        </p>\n      </video>\n    `;try{const a=videojs(`webcam-player-${n}`,{liveui:!0,responsive:!0,fluid:!1,crossorigin:"anonymous",liveTracker:{trackingThreshold:0},controlBar:{captionsButton:!1,pictureInPictureToggle:!1},notSupportedMessage:"비디오 재생 중 오류가 발생했습니다."}),d=document.createElement("button");if(d.className="capture-button",d.innerHTML='\n        <i class="bi bi-camera"></i>\n        캡처\n      ',d.addEventListener("click",(()=>function(e){try{const t=document.createElement("canvas"),n=e.el().querySelector("video");t.width=n.videoWidth,t.height=n.videoHeight;t.getContext("2d").drawImage(n,0,0,t.width,t.height);const i=e.el().id;let a,o;if(i){const n=i.replace("webcam-player-","").split("-");if(n.length>=2){"grid"===n[1]?(a=n[0],o=parseInt(n[2])):(a=n[0],o=parseInt(n[1]));const i=r.find((e=>e.id===a));if(i&&!isNaN(o)){if((i.links||i.webcams||[])[o]){const n=Y(e.el()),i=G(e.el()),a=`capture_${n}_${i}_${Q()}.jpg`;Z(t.toDataURL("image/jpeg"),a);return void J(e.el().parentNode)}}}}const s=Y(e.el()),c=G(e.el()),l=`capture_${s}_${c}_${Q()}.jpg`;Z(t.toDataURL("image/jpeg"),l);J(e.el().parentNode)}catch(e){console.error("Error capturing frame:",e),alert("캡처 중 오류가 발생했습니다.")}}(a))),t.appendChild(d),document.pictureInPictureEnabled||document.exitPictureInPicture&&document.requestPictureInPicture){const e=document.createElement("button");e.className="pip-button",e.innerHTML='\n          <i class="bi bi-pip"></i>\n          PIP\n        ',e.addEventListener("click",(()=>function(e){const t=e.el().querySelector("video");if(!t)return;document.pictureInPictureElement?document.exitPictureInPicture().catch((e=>{console.error("Error exiting Picture-in-Picture mode:",e)})):(document.pictureInPictureEnabled||t.requestPictureInPicture)&&t.requestPictureInPicture().catch((e=>{console.error("Error entering Picture-in-Picture mode:",e)}))}(a))),t.appendChild(e)}return o&&!isNaN(s)&&z(t,o,s,c,e,i,V.DEFAULT),a.on("error",(function(){const n=a.error();console.error("Video player error:",n);let d=null;if(l&&l.webcam)d=l.webcam.link||null;else{const e=r.find((e=>e.id===o));if(e){const t=e.links||e.webcams||[];t[s]&&t[s].link&&(d=t[s].link)}}let m='<div class="error-message"><p>비디오 재생 중 오류가 발생했습니다.</p>';d&&(m+=`<div class="mt-3">\n            <a href="${d}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">\n              <i class="bi bi-box-arrow-up-right me-2"></i>\n              원본 링크에서 보기\n            </a>\n          </div>`),m+="</div>",t.innerHTML=m,o&&!isNaN(s)&&z(t,o,s,c,e,i,V.ERROR)})),a}catch(n){return console.error("Error creating video player:",n),t.innerHTML='<div class="error-message">비디오 플레이어를 생성하는 중 오류가 발생했습니다.</div>',o&&!isNaN(s)&&z(t,o,s,c,e,i,V.ERROR),null}}const V={ERROR:1,LINK:2,YOUTUBE:3,VIVALDI:4,DEFAULT:0};function z(e,t,n,i,a,o,s=V.DEFAULT){if("string"==typeof t&&t.includes("favorite-player"))return;if(e.querySelector(".bookmark-button"))return;const c=document.createElement("button");c.className="bookmark-button",c.setAttribute("data-resort-id",t),c.setAttribute("data-webcam-index",n),c.innerHTML='\n      <span class="bookmark-icon"><i class="bi bi-bookmark"></i></span>\n      북마크\n    ',c.addEventListener("click",(function(){N(t,n,i,a,o)})),s===V.ERROR?c.classList.add("bookmark-button-error"):s===V.LINK?c.classList.add("bookmark-button-link"):s===V.YOUTUBE?c.classList.add("bookmark-button-youtube"):s===V.VIVALDI&&c.classList.add("bookmark-button-vivaldi"),e.appendChild(c)}function J(e){const t=document.createElement("div");t.className="alert alert-success position-absolute top-0 start-50 translate-middle-x mt-3 success-message",t.textContent="캡처 완료!",e.appendChild(t),setTimeout((()=>{t.classList.add("fade-out"),setTimeout((()=>{t.remove()}),500)}),2e3)}function Y(e){if(e){const t=e.closest(".favorite-card");if(t){const e=t.querySelector(".favorite-resort");if(e&&e.textContent)return X(e.textContent.trim())}}const t=document.querySelector(".content-section.active .resort-label");if(t&&t.textContent)return X(t.textContent.trim());const n=window.location.hash.substring(1);if(n){const e=n.split("/")[0],t=r.find((t=>t.id===e));if(t)return X(t.name)}const i=document.querySelector(".menu-item.active");if(i){return X(i.textContent.trim().split("\n")[0])}return"unknown"}function G(e){const t=e.closest(".video-container"),n=t?.closest(".favorite-card");if(n){const e=n.querySelector(".favorite-location");if(e&&e.textContent)return X(e.textContent.trim())}const i=t.querySelector(".vjs-tech")||t.querySelector("iframe")||t.querySelector(".vivaldi-container");if(i&&i.id){const e=i.id.match(/player-([^-]+)-(\d+)/)||i.id.match(/player-([^-]+)-grid-(\d+)/);if(e&&e.length>=3){const t=e[1],n=parseInt(e[2]),i=r.find((e=>e.id===t));if(i){const e=i.links||i.webcams||[];if(e[n])return X(e[n].name)}}}const a=document.querySelector(".submenu-item.active");if(a&&!a.classList.contains("submenu-item-status"))return X(a.textContent.trim());const o=document.querySelector(".content-section.active .inline-title.inline-title-submenu");if(o&&o.textContent)return X(o.textContent.trim());const s=window.location.hash.substring(1);if(s){const e=s.split("/");if(e.length>1){const t=e[0],n=e[1];if(t&&n&&!isNaN(parseInt(n))){const e=r.find((e=>e.id===t));if(e){const t=e.links||e.webcams||[],i=parseInt(n);if(t[i])return X(t[i].name)}}}}const c=e.closest(".video-card");if(c){const e=c.querySelector("h3");if(e)return X(e.textContent.trim())}return"webcam"}function Q(){const e=new Date;return`${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}_${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`}function X(e){return e.replace(/[^가-힣\w\s,()-]/g,"").replace(/\s+/g,"_")}function Z(e,t){const n=document.createElement("a");n.href=e,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function ee(){window.innerWidth<=768&&(t.classList.remove("active"),n.classList.remove("active"))}function te(){fetch("weather.grid.json?v="+(new Date).getTime()).then((e=>{if(!e.ok)throw new Error("Failed to load forecast data");return e.json()})).then((e=>{!function(e){const t=document.getElementById("forecast");if(!t)return;t.innerHTML="";const n=document.createElement("div");n.className="forecast-header";const i=new Date(e.last_fetch_time);n.innerHTML=`<h4>5일 예보 <small>(${i.toLocaleDateString("ko-KR")} ${i.toLocaleTimeString("ko-KR")} 업데이트)</small></h4>`,t.appendChild(n);const a={temperature:"rgb(255, 99, 132)",wind:"rgb(54, 162, 235)",snowfall:"rgb(153, 102, 255)"},o=new Date,s=[];for(let e=0;e<=120;e+=3){const t=new Date(o.getTime()+60*e*60*1e3);s.push(t)}const c=r.filter((e=>e.name)),l=document.createElement("div");l.className="chart-grid",t.appendChild(l);const d=e.weathers;c.forEach((e=>{const t=e.name,n=d.find((e=>e&&"object"==typeof e&&e.resort===t));if(!n)return void console.error(`No forecast data found for resort ${t}`);const i=document.createElement("div");i.className="chart-container";const o=document.createElement("div");o.className="chart-header";const c=document.createElement("h4");if(c.textContent=t,o.appendChild(c),!n.forecasts){console.error(`Invalid data format for resort ${t}:`,n);const e=document.createElement("div");return e.className="alert alert-warning",e.textContent=`${t}의 예보 데이터를 불러올 수 없습니다.`,i.appendChild(e),void l.appendChild(i)}const r=Math.max(...n.forecasts.map((e=>e.temp||-1/0))),m=Math.min(...n.forecasts.map((e=>e.temp||1/0))),u=n.forecasts.reduce(((e,t)=>e+(t.snow_3h||0)),0),p=document.createElement("div");p.className="forecast-summary",p.innerHTML=`\n        <span class="temp-range">기온: ${m.toFixed(1)}°C ~ ${r.toFixed(1)}°C</span>\n        <span class="total-snow">총 강설량: ${u.toFixed(1)}cm</span>\n      `,o.appendChild(p),i.appendChild(o);const h=document.createElement("canvas");h.id=`chart-${e.id}`,i.appendChild(h),l.appendChild(i);const f=[],v=[],g=[];s.forEach((e=>{const t=n.forecasts.find((t=>{const n=new Date(t.timestamp);return Math.abs(n-e)<108e5}));t?(f.push(t.temp),v.push(t.wind_speed),g.push(t.snow_3hr||0)):(f.push(null),v.push(null),g.push(null))})),new Chart(h,{type:"line",data:{labels:s,datasets:[{label:"기온 (°C)",data:f,borderColor:a.temperature,backgroundColor:a.temperature+"33",borderWidth:2,yAxisID:"y",tension:.3,pointRadius:3,pointHoverRadius:5},{label:"풍속 (m/s)",data:v,borderColor:a.wind,backgroundColor:a.wind+"33",borderWidth:2,yAxisID:"y1",tension:.3,pointRadius:3,pointHoverRadius:5},{label:"강설량 (cm/3h)",data:g,borderColor:a.snowfall,backgroundColor:a.snowfall+"33",borderWidth:2,yAxisID:"y2",tension:.3,pointRadius:3,pointHoverRadius:5}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{tooltip:{callbacks:{title:function(e){const t=new Date(e[0].parsed.x);return t.toLocaleDateString("ko-KR")+" "+t.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})}}},legend:{position:"top",labels:{usePointStyle:!0,padding:15}}},scales:{x:{type:"time",time:{unit:"day",displayFormats:{day:"M/d"},tooltipFormat:"yyyy년 MM월 dd일 HH:mm"},title:{display:!0,text:"날짜/시간",font:{weight:"bold"}},ticks:{maxRotation:0}},y:{type:"linear",display:!0,position:"left",title:{display:!0,text:"기온 (°C)",font:{weight:"bold"}},suggestedMin:m-5,suggestedMax:r+5},y1:{type:"linear",display:!0,position:"right",title:{display:!0,text:"풍속 (m/s)",font:{weight:"bold"}},grid:{drawOnChartArea:!1}},y2:{type:"linear",display:!0,position:"right",title:{display:!0,text:"강설량 (cm/3h)",font:{weight:"bold"}},grid:{drawOnChartArea:!1},suggestedMin:0,suggestedMax:1.5*Math.max(...g)||10}}}})})),0===l.children.length&&(t.innerHTML='<div class="alert alert-info">예보 데이터가 없습니다.</div>')}(e)})).catch((e=>{console.error("Error loading forecast data:",e);const t=document.getElementById("forecast");t&&(t.innerHTML='<div class="alert alert-danger">일기예보 데이터를 불러오지 못했습니다.</div>')}))}e.addEventListener("click",(function(){t.classList.toggle("active"),n.classList.toggle("active")})),n.addEventListener("click",ee),window.addEventListener("resize",(function(){d=window.innerWidth<=768,window.innerWidth>768&&(t.classList.remove("active"),n.classList.remove("active"))})),window.addEventListener("hashchange",O),function(){let e=Promise.resolve(null);window.location.hash&&(e=fetch("weather.json?v="+(new Date).getTime()).then((e=>e.ok?e.json():(console.warn("Weather data not available"),null))).then((e=>e?(l=e,e):null)).catch((e=>(console.error("Error loading weather data:",e),null)))),fetch("links.json?v="+(new Date).getTime()).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((n=>{if(Array.isArray(n)&&n.length>0)return function(e){r=e,t.innerHTML='<div class="site-title"><a href="./">Slopes cam</a></div>',document.getElementById("default-message"),Array.from(document.querySelectorAll(".content-section:not(#default-message)")).forEach((e=>e.remove()));const n=document.createElement("div");n.className="menu-item-container";const l=document.createElement("div");l.className="menu-item",l.setAttribute("data-target","misc"),l.setAttribute("data-has-submenu","true"),l.textContent="유용한 기능",n.appendChild(l);const d=document.createElement("span");d.className="dropdown-toggle",d.innerHTML='<i class="bi bi-chevron-down"></i>',d.setAttribute("aria-label","Toggle submenu"),l.appendChild(d),d.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();const t=n.querySelector(".submenu");if(t){const e=t.classList.contains("active");R(),e||(t.classList.add("active"),l.classList.add("active"),this.innerHTML='<i class="bi bi-chevron-up"></i>')}}));const m=document.createElement("div");m.className="submenu",m.id="misc-submenu",n.appendChild(m);const u=document.createElement("div");u.className="submenu-item",u.setAttribute("data-target","misc-forecast"),u.textContent="일기예보",m.appendChild(u);const p=document.createElement("div");p.className="content-section",p.id="misc-forecast";const h=document.createElement("h2");h.textContent="일기예보",h.className="inline-title",p.appendChild(h);const f=document.createElement("div");f.className="misc-content",f.innerHTML='\n      <div class="forecast-container">\n        <div id="forecast"></div>\n      </div>\n    ',p.appendChild(f),i.appendChild(p),u.addEventListener("click",(function(){document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")})),this.classList.add("active"),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const e=document.getElementById("default-message");e.classList.remove("active"),e.style.display="none",p.classList.add("active"),window.location.hash="misc/forecast",document.title=`${a} - 일기예보`,_(),te(),ee()}));const v=document.createElement("div");v.className="content-section",v.id="misc";const g=document.createElement("h2");g.textContent="유용한 기능",g.className="inline-title",v.appendChild(g);const b=document.createElement("div");b.className="misc-content",b.innerHTML="\n      <p>메뉴에서 기능을 선택하세요.</p>\n    ",v.appendChild(b),i.appendChild(v),l.addEventListener("click",(function(e){if(e.target.classList.contains("dropdown-toggle")||e.target.closest(".dropdown-toggle"))return;document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".submenu-item").forEach((e=>e.classList.remove("active"))),this.classList.add("active"),R(),W(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const t=document.getElementById("default-message");t.classList.remove("active"),t.style.display="none";const n=document.getElementById("misc-submenu");if(n){n.classList.add("active"),this.classList.add("active");const e=this.querySelector(".dropdown-toggle");e&&(e.innerHTML='<i class="bi bi-chevron-up"></i>')}const i=document.getElementById("misc");i&&i.classList.add("active"),window.location.hash="misc",document.title=`${a} - 유용한 기능`,ee()})),e.forEach((e=>{const n=e.id,a=e.name,r=e.links||e.webcams||[],l=r.length>0;if(0===r.length)return;const d=document.createElement("div");d.className="menu-item-container";const m=document.createElement("div");if(m.className="menu-item",m.setAttribute("data-target",n),l&&(m.setAttribute("data-has-submenu","true"),m.setAttribute("data-resort-id",n)),m.textContent=a,d.appendChild(m),l){const e=document.createElement("span");e.className="dropdown-toggle",e.innerHTML='<i class="bi bi-chevron-down"></i>',e.setAttribute("aria-label","Toggle submenu"),m.appendChild(e),e.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();const t=d.querySelector(".submenu");if(t){const e=t.classList.contains("active");R(),e||(t.classList.add("active"),m.classList.add("active"),this.innerHTML='<i class="bi bi-chevron-up"></i>')}}))}t.appendChild(d);const u=document.createElement("div");u.className="content-section",u.id=l?`${n}-main`:n;const p=document.createElement("h2");if(p.textContent=a,p.className="inline-title",u.appendChild(p),i.appendChild(u),l){const t=document.createElement("div");if(t.className="submenu",t.id=`${n}-submenu`,d.appendChild(t),e.status){const n=document.createElement("div");n.className="submenu-item submenu-item-status",n.innerHTML='오픈현황 <i class="bi bi-box-arrow-up-right me-1"></i>',t.appendChild(n),n.addEventListener("click",(function(){window.open(e.status,"_blank","noopener,noreferrer")}))}r.forEach(((e,s)=>{const l=e.name;if(!l)return;const d=document.createElement("div");d.className="submenu-item",d.setAttribute("data-target",`${n}-webcam-${s}`),d.setAttribute("data-webcam-index",s),d.textContent=l,t.appendChild(d);const m=document.createElement("div");m.className="content-section",m.id=`${n}-webcam-${s}`;const u=document.createElement("h2");u.textContent=l,u.className="inline-title inline-title-submenu cursor-pointer",u.addEventListener("click",(function(){const e=document.querySelector(`#${n}-submenu .submenu-item[data-webcam-index="${s}"]`);e&&e.click()})),m.appendChild(u);const p=document.createElement("span");p.textContent=a,p.className="resort-label",m.appendChild(p);const h=document.createElement("div");h.className="video-container",m.appendChild(h),i.appendChild(m),d.addEventListener("click",(function(){const e=this.getAttribute("data-webcam-index");c=e,j(n,e),P(n,e),document.querySelectorAll(".submenu-item").forEach((e=>{e.classList.remove("active")})),this.classList.add("active"),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const t=document.getElementById("default-message");t.classList.remove("active"),t.style.display="none";const i=document.getElementById(this.getAttribute("data-target"));if(i){i.classList.add("active"),W();const t=i.querySelector(".video-container");if(t&&r[e]){const i=r[e].video||r[e].link;if(i){const a=K(i,t,`${n}-${e}`,r[e].video_type);a&&o.push(a),U(n)}else t.innerHTML='<div class="error-message">No video stream available</div>'}}ee()}))}))}m.addEventListener("click",(function(e){if(e.target.classList.contains("dropdown-toggle")||e.target.closest(".dropdown-toggle"))return;const t=this.getAttribute("data-target"),n="true"===this.getAttribute("data-has-submenu"),i=this.getAttribute("data-resort-id");if(i&&(s=i,c=null),j(t),P(t,null),document.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".submenu-item").forEach((e=>e.classList.remove("active"))),this.classList.add("active"),R(),n){const e=document.getElementById(`${t}-submenu`);if(e){e.classList.add("active"),this.classList.add("active");const t=this.querySelector(".dropdown-toggle");t&&(t.innerHTML='<i class="bi bi-chevron-up"></i>')}}W(),document.querySelectorAll(".content-section").forEach((e=>{e.classList.remove("active")}));const a=document.getElementById("default-message");if(a.classList.remove("active"),a.style.display="none",n){const e=document.getElementById(`${t}-main`);e&&(e.classList.add("active"),F(t))}else{const e=document.getElementById(t);e&&e.classList.add("active")}U(t),ee()}))})),!window.location.hash&&r.length>0||window.location.hash&&O()}(n),e.then((e=>e||fetch("weather.json?v="+(new Date).getTime()).then((e=>e.ok?e.json():(console.warn("Weather data not available"),null)))));throw new Error("Invalid data format")})).then((e=>{if(e){if(l=e,console.log("Weather data loaded:",l.length,"locations"),window.location.hash){const e=window.location.hash.substring(1).split("/")[0];e&&U(e)}_()}window.location.hash?O():S()})).catch((e=>{console.error("Error initializing app:",e);const t=document.getElementById("default-message");t?(t.innerHTML='<div class="error-message p-5 text-center"><h3>리조트 정보를 불러오지 못했습니다.</h3><p>페이지를 새로고침하세요.</p></div>',t.classList.add("active")):i.innerHTML='<div class="error-message">리조트 정보를 불러오지 못했습니다.</div>'}))}()}));